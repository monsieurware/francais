<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IB French B ‚Äì Bingo d‚Äôexpression orale (Image)</title>
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb;
      --brand:#22d3ee; --brand2:#a78bfa; --accent:#34d399; --danger:#f87171;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --free-bg:linear-gradient(180deg, rgba(52,211,153,.35), rgba(34,211,238,.45));
      --free-color:#22d3ee;
    }
    html,body{height:100%}
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans"; color:var(--text); background:radial-gradient(1200px 600px at 15% 0%, #1f2937 0%, var(--bg) 60%)}
    .wrap{max-width:1200px; margin:0 auto; padding:24px 18px 72px}
    header{display:grid; grid-template-columns:1fr; gap:16px; align-items:center; margin-bottom:18px}
    @media(min-width:900px){header{grid-template-columns:1.3fr .9fr}}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow:var(--shadow)}
    .imgCard{position:relative; overflow:hidden}
    .imgCard img{display:block; width:100%; height:100%; object-fit:cover; border-radius:16px}
    .imgInfo{position:absolute; inset:auto 12px 12px 12px; background:rgba(0,0,0,.45); backdrop-filter:blur(8px); border:1px solid rgba(255,255,255,.1); border-radius:12px; padding:10px 12px; font-size:.9rem}
    .controls{display:flex; flex-wrap:wrap; gap:10px}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12); color:var(--text); background:linear-gradient(180deg, rgba(34,211,238,.1), rgba(167,139,250,.06)); cursor:pointer; transition:.15s transform ease, .2s filter ease; user-select:none}
    .btn:hover{filter:brightness(1.1)}
    .btn:active{transform:translateY(1px)}
    .btn.ghost{background:transparent}
    .btn.danger{background:linear-gradient(180deg, rgba(248,113,113,.15), transparent)}
    .grid{margin-top:16px; display:grid; grid-template-columns:repeat(5,1fr); gap:10px}
    .cell{min-height:130px; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:12px; position:relative; overflow:hidden; cursor:pointer; transition:.15s transform ease, .25s box-shadow ease}
    .cell:hover{box-shadow:0 10px 25px rgba(34,211,238,.15); transform:translateY(-2px)}
    .cell h4{margin:0 0 6px; font-size:.95rem; color:var(--brand)}
    .cell p{margin:0; font-size:.92rem; color:var(--text)}
    .badge{position:absolute; top:8px; right:8px; font-size:.75rem; background:rgba(52,211,153,.2); color:#d1fae5; border:1px solid rgba(52,211,153,.35); padding:4px 8px; border-radius:999px; display:none}
    .cell.completed .badge{display:inline-block}
    .cell.free{background:var(--free-bg)}
    .cell.free h4{color:var(--free-color); text-shadow:0 0 6px rgba(34,211,238,.85)}
    .assist{margin-top:6px; font-size:.8rem; color:var(--muted)}
    dialog{border:none; border-radius:16px; padding:0; background:transparent}
    .modal{width:min(780px,94vw); background:linear-gradient(180deg,#0b1220,#0a0f1a); border:1px solid rgba(255,255,255,.1); border-radius:16px; box-shadow:var(--shadow); overflow:hidden}
    .modal header{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08)}
    .modal header h3{margin:0; font-size:1.05rem}
    .modal .body{display:grid; grid-template-columns:1fr; gap:12px; padding:14px 16px}
    .modal .prompt{font-size:.98rem; color:#e2e8f0}
    .kbdRow{display:flex; flex-wrap:wrap; gap:8px; padding:10px; border:1px dashed rgba(255,255,255,.15); border-radius:12px; background:rgba(255,255,255,.03)}
    .kbdRow button{padding:6px 10px; border-radius:8px; background:#0b1526; color:#e5e7eb; border:1px solid rgba(255,255,255,.12); cursor:pointer}
    textarea{width:100%; min-height:140px; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:#0b1526; color:var(--text); resize:vertical}
    .modal footer{display:flex; justify-content:space-between; align-items:center; gap:8px; padding:14px 16px; border-top:1px solid rgba(255,255,255,.08)}
    .hint{font-size:.85rem; color:var(--muted)}
    .toast{position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#0b1526; border:1px solid rgba(255,255,255,.12); color:var(--text); padding:10px 14px; border-radius:10px; display:none}
    .banner{display:none; place-items:center; position:fixed; inset:0; background:rgba(0,0,0,.6); backdrop-filter:blur(2px)}
    .banner .inner{background:linear-gradient(180deg, rgba(34,211,238,.2), rgba(167,139,250,.15)); border:1px solid rgba(255,255,255,.16); padding:22px 26px; border-radius:16px; text-align:center}
    .banner h2{margin:0 0 10px}
    .small{font-size:.86rem; color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <section class="card imgCard">
        <img src="https://www.consoglobe.com/wp-content/uploads/2021/02/sans-abris_shutterstock_1285915336-645x338.jpg" alt="Image pour discussion: une personne sans-abri assise pr√®s d'un mur, avec des effets personnels" />
        <div class="imgInfo">
          <strong>D√©clencheur visuel</strong> ‚Äî Observe l‚Äôimage pendant 30 secondes. Puis choisis des cases du bingo et parle.
        </div>
      </section>
      <section class="card" style="padding:14px 16px">
        <h2 style="margin:8px 0 12px; letter-spacing:.3px">Bingo d‚Äôexpression orale ‚Äì IB French B (SL)</h2>
        <p class="small" style="margin-top:0">Objectif : d√©clencher une interaction riche (th√®mes : Organisation sociale ‚Ä¢ Partage de la plan√®te ‚Ä¢ Identit√©s). Clique une case pour √©crire/pr√©senter. 5 d‚Äôaffil√©e = <em>BINGO</em> !</p>
        <div class="controls">
          <button class="btn" id="shuffleBtn">üîÄ M√©langer</button>
          <button class="btn" id="clearBtn">üßπ Effacer les r√©ponses</button>
          <button class="btn" id="exportBtn">‚¨áÔ∏è Exporter (CSV)</button>
          <button class="btn ghost" id="helpBtn">‚ùì Aide</button>
        </div>
      </section>
    </header>

    <section class="grid" id="grid" aria-label="Bingo ‚Äì 5 par 5"></section>

    <p class="small">Astuce : S√©lectionne un champ de r√©ponse puis utilise le <strong>clavier d‚Äôaccents</strong> dans la fen√™tre pour ins√©rer facilement √©, √®, √†, √ß, etc.</p>
  </div>

  <!-- Modal for responses -->
  <dialog id="dlg">
    <div class="modal" role="dialog" aria-modal="true">
      <header>
        <h3 id="dlgTitle">R√©ponds √† la t√¢che</h3>
        <button class="btn ghost" id="closeDlg">‚úñ</button>
      </header>
      <div class="body">
        <div class="prompt" id="dlgPrompt"></div>
        <label for="resp" class="hint">Ta r√©ponse (tu peux parler d‚Äôabord, puis √©crire un bref r√©sum√©) :</label>
        <textarea id="resp" placeholder="√âcris ici‚Ä¶"></textarea>
        <div>
          <div class="hint" style="margin-bottom:6px"><strong>Clavier d‚Äôaccents</strong> : clique pour ins√©rer dans le texte</div>
          <div class="kbdRow" id="kbd"></div>
        </div>
      </div>
      <footer>
        <span class="hint" id="count">0/800 caract√®res</span>
        <div style="display:flex; gap:8px">
          <button class="btn" id="save">üíæ Enregistrer</button>
          <button class="btn danger" id="clearCell">Effacer la r√©ponse</button>
        </div>
      </footer>
    </div>
  </dialog>

  <div class="toast" id="toast">Enregistr√© ‚úÖ</div>
  <div class="banner" id="banner">
    <div class="inner">
      <h2>üéâ BINGO !</h2>
      <p>Tu as compl√©t√© cinq cases d‚Äôaffil√©e. Maintenant, √©change et approfondis avec tes camarades.</p>
      <button class="btn" id="dismissBanner">OK</button>
    </div>
  </div>

  <script>
    // Prompts (24) + center free card
    const PROMPTS = [
      {t:'D√©cris la sc√®ne avec <em>3 d√©tails sensoriels</em> (vue, sons, temp√©rature).'},
      {t:"Quelles <strong>√©motions</strong> ressens-tu face √† cette image ? Justifie."},
      {t:"Relie l‚Äôimage au th√®me <em>Organisation sociale</em> : quels enjeux ?"},
      {t:"Fais une hypoth√®se (<em>si + imparfait</em> ‚Üí conditionnel) sur une cause."},
      {t:"Explique <strong>deux causes</strong> et <strong>deux cons√©quences</strong> possibles."},
      {t:"Utilise des connecteurs : cependant, pourtant, en revanche, par cons√©quent."},
      {t:"Compare avec une situation <em>dans ta communaut√©</em> (similitudes/diff√©rences)."},
      {t:"Propose <strong>deux solutions r√©alisables</strong> (court/long terme)."},
      {t:"Formule une recommandation : ¬´ <em>il faudrait que‚Ä¶</em> ¬ª (subjonctif)."},
      {t:"Analyse le <em>cadrage / lumi√®re</em> : quel effet sur le message ?"},
      {t:"Reformule et nuan√ße l‚Äôid√©e d‚Äôun pair (<em>je comprends, mais‚Ä¶</em>)."},
      {t:"D√©finis ¬´ sans-abri ¬ª vs ¬´ mal-log√© ¬ª. Pourquoi la nuance compte ?"},
      {t:"Relie aux <em>ODD/ONU</em> (ex. Pas de pauvret√©). Donne un indicateur mesurable."},
      {t:"Quel st√©r√©otype faut-il √©viter ? Reformule une id√©e de fa√ßon respectueuse."},
      {t:"Exprime un <strong>d√©saccord poli</strong> en 2 phrases avec un exemple."},
      {t:"Invente un <em>slogan</em> et 1 action pour une campagne locale."},
      {t:"R√©dige une question ouverte pour un entretien avec une association."},
      {t:"Explique 1 <em>mot cl√©</em> (ex. pr√©carit√©) et utilise-le dans une phrase."},
      {t:"Relie au th√®me <em>Identit√©s</em> : dignit√©, regard social, inclusion."},
      {t:"Relie au th√®me <em>Partage de la plan√®te</em> : ressources, espaces publics."},
      {t:"D√©cris un <em>choix de photographe</em> (angle, profondeur) et son impact."},
      {t:"Formule une <em>question de TOK</em> : que peut une image prouver ?"},
      {t:"Imagine une <em>politique communale</em> : objectifs & crit√®res d‚Äô√©valuation."},
      {t:"Pose une question √† un camarade et <strong>relance</strong> avec ¬´ et si‚Ä¶ ? ¬ª"}
    ];

    const ACCENTS = ['√†','√¢','√§','√¶','√ß','√©','√®','√™','√´','√Æ','√Ø','√¥','≈ì','√∂','√π','√ª','√º','√ø','√Ä','√á','√â','√à','√ä','√ã','√é','√è','√î','√ô','√õ','√ú','¬´','¬ª','‚Ç¨'];

    const LS_KEY = 'ibfb-bingo-v2';
    const gridEl = document.getElementById('grid');
    const toast = document.getElementById('toast');
    const banner = document.getElementById('banner');

    let board = []; // 5x5 cell objects {id,prompt,response,completed,free}
    let currentId = null;

    const shuffle = (arr) => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);

    function buildBoard(){
      const base = shuffle([...PROMPTS]);
      const cells = [];
      for(let i=0;i<25;i++){
        if(i===12){
          cells.push({id:'c12', prompt:'Propose ton propre angle d‚Äôanalyse.', response:'', completed:false, free:true});
        } else {
          const p = base.pop();
          cells.push({id:'c'+i, prompt:p.t, response:'', completed:false, free:false});
        }
      }
      board = cells; save(); render();
    }

    function render(){
      gridEl.innerHTML = '';
      board.forEach((cell, idx)=>{
        const el = document.createElement('button');
        el.className = 'cell'+(cell.completed?' completed':'')+(cell.free?' free':'');
        el.setAttribute('data-id', cell.id);
        el.setAttribute('aria-label', 'Case '+(idx+1));
        if(cell.free){
          el.innerHTML = `<h4>CARTE LIBRE</h4><p>${cell.prompt}</p><span class="badge">Fait</span>${cell.response?`<div class=assist>R√©ponse sauvegard√©e ‚úì</div>`:''}`;
        } else {
          el.innerHTML = `<h4>T√ÇCHE</h4><p>${cell.prompt}</p><span class="badge">Fait</span>${cell.response?`<div class=assist>R√©ponse sauvegard√©e ‚úì</div>`:''}`;
        }
        el.addEventListener('click', ()=>openCell(cell.id));
        gridEl.appendChild(el);
      });
    }

    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(board)); }
    function load(){
      const raw = localStorage.getItem(LS_KEY);
      if(raw){ try{ board = JSON.parse(raw); render(); return; }catch(e){} }
      buildBoard();
    }

    // Modal and input helpers
    const dlg = document.getElementById('dlg');
    const dlgPrompt = document.getElementById('dlgPrompt');
    const resp = document.getElementById('resp');
    const closeDlg = document.getElementById('closeDlg');
    const saveBtn = document.getElementById('save');
    const clearCellBtn = document.getElementById('clearCell');
    const count = document.getElementById('count');
    const kbd = document.getElementById('kbd');

    function openCell(id){
      currentId = id;
      const cell = board.find(c=>c.id===id);
      dlgPrompt.innerHTML = (cell.free? '<strong>CARTE LIBRE</strong> ‚Äì ' : '<strong>T√ÇCHE</strong> ‚Äì ') + cell.prompt;
      resp.value = cell.response || '';
      updateCount();
      if(!dlg.open) dlg.showModal();
      setTimeout(()=>resp.focus(), 40);
    }
    function closeModal(){ dlg.close(); currentId = null; }

    function updateCount(){ count.textContent = `${resp.value.length}/800 caract√®res`; }
    resp.addEventListener('input', updateCount);

    function mountKeyboard(){
      kbd.innerHTML = '';
      ACCENTS.forEach(ch=>{
        const b = document.createElement('button');
        b.type='button'; b.textContent=ch;
        b.addEventListener('click', ()=>insertAtCursor(resp, ch));
        kbd.appendChild(b);
      });
    }
    function insertAtCursor(field, text){
      const start = field.selectionStart, end = field.selectionEnd;
      const val = field.value;
      field.value = val.slice(0,start) + text + val.slice(end);
      field.selectionStart = field.selectionEnd = start + text.length;
      field.focus(); updateCount();
    }

    saveBtn.addEventListener('click', ()=>{
      if(currentId==null) return;
      const cell = board.find(c=>c.id===currentId);
      cell.response = resp.value.slice(0,800);
      cell.completed = (cell.response.trim().length >= 10) || !!cell.free;
      save(); render(); showToast('Enregistr√© ‚úÖ'); checkBingo(); closeModal();
    });
    clearCellBtn.addEventListener('click', ()=>{
      if(currentId==null) return;
      const cell = board.find(c=>c.id===currentId);
      cell.response=''; cell.completed = !!cell.free; save(); render(); showToast('R√©ponse effac√©e');
      resp.value=''; updateCount();
    });
    closeDlg.addEventListener('click', closeModal);

    // Top buttons
    document.getElementById('shuffleBtn').addEventListener('click', ()=>{
      if(confirm('M√©langer r√©initialise les invites (les r√©ponses sauvegard√©es seront supprim√©es). Continuer ?')){
        localStorage.removeItem(LS_KEY); buildBoard(); showToast('Nouveau tirage üé≤');
      }
    });
    document.getElementById('clearBtn').addEventListener('click', ()=>{
      if(confirm('Effacer toutes les r√©ponses ?')){
        board.forEach(c=>{ c.response=''; c.completed=!!c.free; }); save(); render(); showToast('Effac√©');
      }
    });
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const rows = [['#','Libell√©','Invite','R√©ponse','Compl√©t√©e']];
      board.forEach((c,i)=>rows.push([i+1, c.free?'CARTE LIBRE':'T√ÇCHE', strip(c.prompt), (c.response||'').replaceAll('\n',' '), c.completed?'oui':'non']));
      const csv = rows.map(r=>r.map(x=>`"${String(x).replaceAll('"','""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='bingo-ib-frenchb.csv'; a.click(); URL.revokeObjectURL(url);
    });
    document.getElementById('helpBtn').addEventListener('click', ()=>{
      alert('But: Obtenir 5 cases d\'affil√©e (ligne/colonne/diagonale).\n1) Clique une case.\n2) Parle d\'abord, puis √©cris un court r√©sum√©.\n3) Enregistre.\n4) √âcoute, relance, nuance.');
    });

    function strip(html){ const tmp=document.createElement('div'); tmp.innerHTML=html; return tmp.textContent||tmp.innerText||''; }

    // Bingo detection
    const lines = [];
    for(let r=0;r<5;r++){ lines.push([0,1,2,3,4].map(c=>r*5+c)); }
    for(let c=0;c<5;c++){ lines.push([0,1,2,3,4].map(r=>r*5+c)); }
    lines.push([0,6,12,18,24]); lines.push([4,8,12,16,20]);
    function checkBingo(){
      const ok = (idx)=> board[idx].completed;
      const has = lines.some(line => line.every(ok));
      if(has){ banner.style.display='grid'; }
    }
    document.getElementById('dismissBanner').addEventListener('click', ()=>{ banner.style.display='none'; });

    function showToast(msg){
      toast.textContent = msg; toast.style.display='block';
      setTimeout(()=>toast.style.display='none', 1500);
    }

    // Init
    load();
    mountKeyboard();
  </script>
</body>
</html>
