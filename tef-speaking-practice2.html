<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEF Canada ‚Äî Expression orale NCLC 8 (Module 2)</title>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:opsz,wght@8..60,400;8..60,600;8..60,700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f1419;
            --bg-secondary: #1a2332;
            --bg-tertiary: #243044;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            font-family: 'Source Serif 4', serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; }

        .level-badge {
            display: inline-block;
            background: var(--accent-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 0.75rem;
        }

        .module-badge {
            display: inline-block;
            background: var(--accent-green);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 0.75rem;
            margin-left: 0.5rem;
        }

        .api-panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .api-panel input {
            flex: 1;
            min-width: 200px;
            padding: 0.6rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: monospace;
        }

        .api-panel input:focus { outline: none; border-color: var(--accent-blue); }

        .api-status {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            background: var(--bg-tertiary);
        }

        .api-status.active { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-primary:hover:not(:disabled) { background: #2563eb; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-small { padding: 0.5rem 1rem; font-size: 0.85rem; }

        .screen { display: none; }
        .screen.active { display: block; }

        .scenario-grid { display: grid; gap: 1rem; }

        .scenario-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .scenario-card:hover { border-color: var(--accent-blue); transform: translateY(-2px); }

        .scenario-icon {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: 12px;
        }

        .scenario-info h3 { font-size: 1.1rem; margin-bottom: 0.25rem; }
        .scenario-info p { font-size: 0.9rem; color: var(--text-secondary); }

        .context-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
        }

        .context-title { font-family: 'Source Serif 4', serif; font-size: 1.5rem; margin-bottom: 1.5rem; }

        .context-text {
            text-align: left;
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .context-objective {
            text-align: left;
            padding: 1rem 1.5rem;
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid var(--accent-blue);
            border-radius: 0 8px 8px 0;
            margin-bottom: 2rem;
        }

        .progress-bar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 10px;
        }

        .progress-step { flex: 1; height: 6px; background: var(--bg-tertiary); border-radius: 3px; }
        .progress-step.done { background: var(--accent-green); }
        .progress-step.current { background: var(--accent-blue); }
        .progress-text { font-size: 0.85rem; color: var(--text-secondary); white-space: nowrap; margin-left: 0.5rem; }

        .user-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .user-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .user-text {
            font-family: 'Source Serif 4', serif;
            font-size: 1.1rem;
            line-height: 1.7;
            padding: 1.25rem;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border-left: 3px solid var(--accent-green);
            color: var(--text-secondary);
        }

        .interviewer-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .interviewer-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .interviewer-text {
            font-family: 'Source Serif 4', serif;
            font-size: 1.2rem;
            line-height: 1.7;
            padding: 1.25rem;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border-left: 3px solid var(--accent-blue);
        }

        .audio-btn {
            margin-top: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
        }

        .audio-btn:hover { border-color: var(--accent-blue); color: var(--accent-blue); }

        .audio-controls { display: flex; gap: 0.75rem; margin-top: 1rem; flex-wrap: wrap; }

        .interviewer-text.hidden {
            background: var(--bg-tertiary);
            color: transparent;
            user-select: none;
            position: relative;
        }

        .interviewer-text.hidden::after {
            content: 'üëÅÔ∏è Cliquez sur "Afficher le texte" pour voir la transcription';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-muted);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.9rem;
            font-style: normal;
            white-space: nowrap;
        }

        .questions-section { margin-bottom: 1.5rem; }
        .questions-section h3 { font-size: 1rem; color: var(--text-secondary); margin-bottom: 1rem; font-weight: 500; }

        .question-list { display: flex; flex-direction: column; gap: 0.75rem; }

        .question-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 1.25rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .question-item:hover { border-color: var(--accent-blue); background: var(--bg-tertiary); }
        .question-item.selected { border-color: var(--accent-blue); background: rgba(59, 130, 246, 0.1); }

        .question-radio {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 2px;
        }

        .question-item.selected .question-radio { border-color: var(--accent-blue); background: var(--accent-blue); }
        .question-item.selected .question-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }

        .question-content { font-size: 1rem; line-height: 1.6; }

        .validate-row { display: flex; justify-content: flex-end; margin-bottom: 1.5rem; }

        .feedback-box {
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            display: none;
        }

        .feedback-box.visible { display: block; }

        .feedback-box.mauvaise { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--accent-red); }
        .feedback-box.acceptable { background: rgba(245, 158, 11, 0.1); border: 1px solid var(--accent-yellow); }
        .feedback-box.ideale { background: rgba(16, 185, 129, 0.1); border: 1px solid var(--accent-green); }

        .feedback-header { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; margin-bottom: 0.75rem; }
        .feedback-box.mauvaise .feedback-header { color: var(--accent-red); }
        .feedback-box.acceptable .feedback-header { color: var(--accent-yellow); }
        .feedback-box.ideale .feedback-header { color: var(--accent-green); }

        .feedback-content { color: var(--text-secondary); line-height: 1.7; margin-bottom: 1rem; }
        .feedback-actions { display: flex; gap: 0.75rem; }

        .results-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
        }

        .results-box h2 { font-family: 'Source Serif 4', serif; font-size: 1.75rem; margin-bottom: 0.5rem; }
        .results-subtitle { color: var(--text-secondary); margin-bottom: 1.5rem; }

        .score-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 2rem; }

        .score-card { padding: 1.25rem; background: var(--bg-tertiary); border-radius: 12px; }
        .score-card .num { font-size: 2rem; font-weight: 700; }
        .score-card .label { font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem; }
        .score-card.green .num { color: var(--accent-green); }
        .score-card.yellow .num { color: var(--accent-yellow); }
        .score-card.red .num { color: var(--accent-red); }

        .nclc-box { background: var(--bg-tertiary); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; }
        .nclc-box .level { font-size: 2.5rem; font-weight: 700; color: var(--accent-blue); }
        .nclc-box .label { color: var(--text-secondary); font-size: 0.9rem; }

        .tips-box { text-align: left; background: var(--bg-tertiary); padding: 1.25rem; border-radius: 12px; margin-bottom: 1.5rem; }
        .tips-box h4 { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.75rem; }
        .tips-box ul { list-style: none; }
        .tips-box li { padding: 0.5rem 0; padding-left: 1.5rem; position: relative; color: var(--text-secondary); }
        .tips-box li::before { content: '‚Üí'; position: absolute; left: 0; color: var(--accent-blue); }

        .results-actions { display: flex; gap: 1rem; justify-content: center; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>TEF Canada ‚Äî Expression orale</h1>
            <p class="subtitle">Section A : Obtenir des renseignements</p>
            <span class="level-badge">Niveau cible : NCLC 8</span>
            <span class="module-badge">Module 2</span>
        </header>

        <div class="api-panel">
            <span>üîë</span>
            <input type="password" id="apiKey" placeholder="Cl√© API ElevenLabs">
            <button class="btn btn-primary btn-small" onclick="App.activateVoice()">Activer</button>
            <div class="api-status" id="apiStatus">üîá Voix d√©sactiv√©e</div>
        </div>

        <div class="screen active" id="screenSelect">
            <h2 style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 1rem;">Choisissez un sc√©nario :</h2>
            <div class="scenario-grid" id="scenarioList"></div>
        </div>

        <div class="screen" id="screenContext">
            <div class="context-box">
                <div class="context-title" id="ctxTitle"></div>
                <div class="context-text" id="ctxText"></div>
                <div class="context-objective" id="ctxObjective"></div>
                <button class="btn btn-primary" onclick="App.startDialogue()">Commencer l'appel ‚ñ∂</button>
            </div>
        </div>

        <div class="screen" id="screenDialogue">
            <div class="progress-bar" id="progressBar"></div>

            <div class="user-box" id="userBox" style="display: none;">
                <div class="user-label">üó£Ô∏è Vous :</div>
                <div class="user-text" id="userText"></div>
            </div>

            <div class="interviewer-box">
                <div class="interviewer-label">üéß L'interlocuteur :</div>
                <div class="interviewer-text" id="interviewerText"></div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="App.playCurrentAudio()">üîä √âcouter</button>
                    <button class="audio-btn" id="toggleTextBtn" onclick="App.toggleText()">üëÅÔ∏è Masquer le texte</button>
                </div>
            </div>

            <div class="questions-section" id="questionsSection">
                <h3>Choisissez votre question :</h3>
                <div class="question-list" id="questionList"></div>
            </div>

            <div class="validate-row" id="validateRow">
                <button class="btn btn-primary" id="btnValidate" onclick="App.validate()" disabled>Valider ‚ñ∂</button>
            </div>

            <div class="feedback-box" id="feedbackBox">
                <div class="feedback-header" id="feedbackHeader"></div>
                <div class="feedback-content" id="feedbackContent"></div>
                <div class="feedback-actions">
                    <button class="btn btn-primary" id="btnContinue" onclick="App.continue()">Continuer ‚Üí</button>
                </div>
            </div>
        </div>

        <div class="screen" id="screenResults">
            <div class="results-box">
                <h2>üìä R√©sultats</h2>
                <p class="results-subtitle" id="resultsTitle"></p>
                <div class="score-grid">
                    <div class="score-card green"><div class="num" id="scoreIdeale">0</div><div class="label">‚úÖ Id√©ales</div></div>
                    <div class="score-card yellow"><div class="num" id="scoreAcceptable">0</div><div class="label">‚ö†Ô∏è Acceptables</div></div>
                    <div class="score-card red"><div class="num" id="scoreMauvaise">0</div><div class="label">‚ùå Reprises</div></div>
                </div>
                <div class="nclc-box"><div class="label">Estimation NCLC</div><div class="level" id="nclcLevel">7-8</div></div>
                <div class="tips-box"><h4>üí° Conseils</h4><ul id="tipsList"></ul></div>
                <div class="results-actions">
                    <button class="btn btn-secondary" onclick="App.restart()">Recommencer</button>
                    <button class="btn btn-primary" onclick="App.backToMenu()">Autre sc√©nario</button>
                </div>
            </div>
        </div>
    </div>

<script>
// ============================================================
// MODULE 2 SCENARIOS - New voice ID: UJCi4DDncuo0VJDSIegj
// ============================================================
const VOICE_ID = 'UJCi4DDncuo0VJDSIegj';

const SCENARIOS = [
    // ========== SCENARIO 1: OUVRIR UN COMPTE BANCAIRE ==========
    {
        icon: 'üè¶',
        title: 'Ouvrir un compte bancaire',
        context: `Vous venez d'arriver au Canada et vous devez ouvrir un compte bancaire pour recevoir votre salaire. Vous appelez la Banque Nationale pour vous renseigner sur les types de comptes disponibles et les documents n√©cessaires pour l'ouverture.`,
        objective: `<strong>Votre objectif :</strong> Obtenir des informations sur les comptes bancaires, les frais, et la proc√©dure d'ouverture de compte.`,
        opening: `Banque Nationale, service aux particuliers. Bonjour, ici V√©ronique. Comment puis-je vous aider ?`,
        rounds: [
            {
                options: [
                    { text: `Je veux ouvrir un compte.`, type: 'mauvaise' },
                    { text: `Bonjour, c'est pour un compte bancaire.`, type: 'mauvaise' },
                    { text: `Bonjour, je viens d'arriver au Canada et j'aimerais ouvrir un compte bancaire.`, type: 'acceptable' },
                    { text: `Bonjour V√©ronique. Je suis nouvellement arriv√© au Canada et je souhaiterais ouvrir un compte bancaire pour recevoir mon salaire. Pourriez-vous me pr√©senter les diff√©rentes options disponibles ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord... c'est pour quel type de compte exactement ? Vous avez une id√©e de ce que vous cherchez ?`,
                    acceptable: `Bienvenue au Canada ! Nous avons plusieurs types de comptes. Vous cherchez un compte pour un usage quotidien ou plut√¥t pour √©pargner ?`,
                    ideale: `Bienvenue au Canada ! Nous avons plusieurs forfaits adapt√©s aux nouveaux arrivants. Notre compte ¬´ Nouveau d√©part ¬ª offre deux ans sans frais mensuels, des virements internationaux gratuits, et une carte de cr√©dit avec garantie. Souhaitez-vous conna√Ætre les d√©tails de cette offre ?`
                },
                feedback: {
                    mauvaise: `Trop direct et sans contexte. Expliquez votre situation et ce dont vous avez besoin.`,
                    acceptable: `Bon d√©but avec le contexte. Pr√©ciser vos besoins (salaire, type de compte) serait plus efficace.`,
                    ideale: `Excellent ! Vous avez expliqu√© votre situation et vos besoins de fa√ßon claire et professionnelle.`
                }
            },
            {
                options: [
                    { text: `C'est combien par mois ?`, type: 'mauvaise' },
                    { text: `Quels sont les frais ?`, type: 'mauvaise' },
                    { text: `Pourriez-vous me d√©tailler les frais mensuels et ce qui est inclus ?`, type: 'acceptable' },
                    { text: `Oui, j'aimerais conna√Ætre les d√©tails. Quels sont les frais apr√®s la p√©riode promotionnelle, et qu'est-ce qui est inclus dans le forfait : nombre de transactions, virements, acc√®s aux guichets ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Les frais d√©pendent du forfait que vous choisissez. Le forfait de base est √† 4,95 $ par mois.`,
                    acceptable: `Apr√®s deux ans, le forfait est √† 16,95 $ par mois. Cela inclut des transactions illimit√©es et une carte de d√©bit. Avez-vous des questions sur les documents requis ?`,
                    ideale: `Apr√®s les deux ans promotionnels, le forfait passe √† 16,95 $ par mois. Cela comprend des transactions illimit√©es par d√©bit et en ligne, deux virements internationaux gratuits par mois, l'acc√®s √† tous nos guichets sans frais, et une protection contre les d√©couverts. Voulez-vous savoir quels documents sont n√©cessaires pour l'ouverture ?`
                },
                feedback: {
                    mauvaise: `Question trop vague. Demandez ce qui est inclus, pas seulement le prix.`,
                    acceptable: `Bonne question sur les frais. Demander les d√©tails du forfait montrerait plus de pr√©voyance.`,
                    ideale: `Parfait ! Vous anticipez tous les aspects importants du forfait.`
                }
            },
            {
                options: [
                    { text: `Il faut quoi comme papiers ?`, type: 'mauvaise' },
                    { text: `Quels documents vous demandez ?`, type: 'mauvaise' },
                    { text: `Quels documents dois-je fournir pour ouvrir le compte ?`, type: 'acceptable' },
                    { text: `Oui, pourriez-vous me pr√©ciser les documents requis ? En tant que nouvel arrivant, j'ai mon passeport, ma confirmation de r√©sidence permanente et une preuve d'adresse. Est-ce suffisant ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Il nous faut une pi√®ce d'identit√© et une preuve d'adresse. Vous avez √ßa ?`,
                    acceptable: `Nous demandons deux pi√®ces d'identit√© et une preuve d'adresse. Votre passeport et votre carte de r√©sident permanent suffisent. Souhaitez-vous prendre rendez-vous ?`,
                    ideale: `C'est parfait ! Avec votre passeport, votre confirmation de r√©sidence permanente et une preuve d'adresse, vous avez tout ce qu'il faut. Je peux aussi accepter une lettre d'emploi si vous en avez une, pour faciliter l'obtention de la carte de cr√©dit. Voulez-vous prendre rendez-vous en succursale ?`
                },
                feedback: {
                    mauvaise: `Trop informel. Formulez votre question de mani√®re plus professionnelle.`,
                    acceptable: `Bonne question. Mentionner les documents que vous avez d√©j√† acc√©l√©rerait le processus.`,
                    ideale: `Excellent ! Vous montrez que vous √™tes pr√©par√© et facilitez le travail du conseiller.`
                }
            },
            {
                options: [
                    { text: `Je peux venir quand ?`, type: 'mauvaise' },
                    { text: `Vous avez des disponibilit√©s quand ?`, type: 'mauvaise' },
                    { text: `Quelles sont vos disponibilit√©s pour un rendez-vous cette semaine ?`, type: 'acceptable' },
                    { text: `Oui, j'aimerais prendre rendez-vous. Je suis disponible en fin d'apr√®s-midi cette semaine. Quelle succursale me recommanderiez-vous et combien de temps dure le rendez-vous ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `On a des places cette semaine. Vous pr√©f√©rez quel jour ?`,
                    acceptable: `J'ai des disponibilit√©s jeudi et vendredi apr√®s-midi. Le rendez-vous dure environ 45 minutes. Quelle journ√©e vous convient ?`,
                    ideale: `Je vous propose jeudi √† 16h ou vendredi √† 15h30 √† notre succursale du centre-ville, au 500 rue Sainte-Catherine. Le rendez-vous dure environ 45 minutes. Vous repartirez avec votre carte de d√©bit et vos acc√®s en ligne. Quel cr√©neau pr√©f√©rez-vous ?`
                },
                feedback: {
                    mauvaise: `Trop vague. Proposez vos disponibilit√©s et demandez des pr√©cisions.`,
                    acceptable: `Bonne question sur les disponibilit√©s. Demander la dur√©e et le lieu serait plus complet.`,
                    ideale: `Parfait ! Question compl√®te qui couvre horaires, lieu et dur√©e.`
                }
            },
            {
                options: [
                    { text: `Et pour la carte de cr√©dit ?`, type: 'mauvaise' },
                    { text: `Je peux avoir une carte de cr√©dit aussi ?`, type: 'mauvaise' },
                    { text: `Concernant la carte de cr√©dit mentionn√©e, quelles sont les conditions d'obtention ?`, type: 'acceptable' },
                    { text: `Avant de confirmer, pourriez-vous m'expliquer les conditions pour la carte de cr√©dit avec garantie ? Quel est le montant de la garantie requis et comment fonctionne le processus pour obtenir une carte sans garantie par la suite ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `La carte de cr√©dit, c'est avec une garantie au d√©but. On en parlera au rendez-vous.`,
                    acceptable: `Pour la carte de cr√©dit, vous d√©posez une garantie de 500 $ minimum, qui devient votre limite. Apr√®s un an de bon historique, vous pouvez demander une carte r√©guli√®re.`,
                    ideale: `La carte avec garantie fonctionne ainsi : vous d√©posez entre 500 $ et 5 000 $, ce qui devient votre limite de cr√©dit. Apr√®s 12 mois de paiements r√©guliers, nous √©valuons votre dossier pour une carte sans garantie et vous r√©cup√©rez votre d√©p√¥t. Cela vous permet de b√¢tir votre historique de cr√©dit au Canada. √ätes-vous pr√™t √† confirmer le rendez-vous ?`
                },
                feedback: {
                    mauvaise: `Question incompl√®te. Demandez les conditions sp√©cifiques et le processus.`,
                    acceptable: `Bonne question. Demander le processus d'√©volution vers une carte r√©guli√®re serait strat√©gique.`,
                    ideale: `Excellent ! Vous comprenez l'importance de l'historique de cr√©dit et posez les bonnes questions.`
                }
            },
            {
                options: [
                    { text: `OK, jeudi alors.`, type: 'mauvaise' },
                    { text: `D'accord, je prends jeudi. Merci.`, type: 'mauvaise' },
                    { text: `Parfait, je confirme pour jeudi √† 16h. Merci beaucoup pour ces informations.`, type: 'acceptable' },
                    { text: `Excellent, je confirme le rendez-vous pour jeudi √† 16h √† la succursale du 500 rue Sainte-Catherine. J'apporterai mon passeport, ma confirmation de r√©sidence permanente, ma preuve d'adresse et ma lettre d'emploi. Je vous remercie pour toutes ces explications, V√©ronique. √Ä jeudi !`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord, c'est not√©. √Ä jeudi.`,
                    acceptable: `Parfait, je vous inscris. N'oubliez pas vos documents. √Ä jeudi et bonne journ√©e !`,
                    ideale: `C'est parfait, tout est not√© ! Je vous envoie une confirmation par courriel avec l'adresse et la liste des documents. Bienvenue encore au Canada et √† jeudi, ce sera un plaisir de finaliser l'ouverture de votre compte !`
                },
                feedback: {
                    mauvaise: `Trop bref. Confirmez les d√©tails et remerciez votre interlocuteur.`,
                    acceptable: `Bonne confirmation. R√©capituler les documents √† apporter montrerait votre pr√©paration.`,
                    ideale: `Parfait ! R√©capitulatif complet avec tous les d√©tails importants.`
                }
            }
        ]
    },

    // ========== SCENARIO 2: PRENDRE RENDEZ-VOUS CHEZ LE M√âDECIN ==========
    {
        icon: 'üè•',
        title: 'Prendre rendez-vous chez le m√©decin',
        context: `Vous avez besoin de consulter un m√©decin de famille pour un examen de routine et renouveler vos ordonnances. Vous appelez la Clinique m√©dicale Saint-Laurent pour prendre rendez-vous et vous renseigner sur les services offerts.`,
        objective: `<strong>Votre objectif :</strong> Obtenir un rendez-vous avec un m√©decin et comprendre les modalit√©s de consultation.`,
        opening: `Clinique m√©dicale Saint-Laurent, bonjour. Ici Nadia √† la r√©ception. Comment puis-je vous aider ?`,
        rounds: [
            {
                options: [
                    { text: `Je veux voir un m√©decin.`, type: 'mauvaise' },
                    { text: `Bonjour, c'est pour un rendez-vous.`, type: 'mauvaise' },
                    { text: `Bonjour, j'aimerais prendre rendez-vous avec un m√©decin pour un examen de routine.`, type: 'acceptable' },
                    { text: `Bonjour Nadia. Je souhaiterais prendre rendez-vous avec un m√©decin de famille pour un examen g√©n√©ral et le renouvellement de mes ordonnances. Avez-vous des disponibilit√©s prochainement ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `C'est pour quel motif exactement ? Un probl√®me urgent ou un suivi ?`,
                    acceptable: `D'accord. √ätes-vous d√©j√† patient de la clinique ou c'est une premi√®re visite ?`,
                    ideale: `Tr√®s bien. √ätes-vous d√©j√† inscrit √† notre clinique ? Si oui, avez-vous un m√©decin attitr√© ? Pour un examen g√©n√©ral avec renouvellement d'ordonnances, il nous faut un rendez-vous d'environ 30 minutes.`
                },
                feedback: {
                    mauvaise: `Trop vague. Pr√©cisez le motif de votre consultation.`,
                    acceptable: `Bon d√©but. Mentionner tous vos besoins (examen + ordonnances) serait plus efficace.`,
                    ideale: `Excellent ! Vous avez clairement expliqu√© vos besoins pour faciliter la prise de rendez-vous.`
                }
            },
            {
                options: [
                    { text: `Oui, je suis d√©j√† patient.`, type: 'mauvaise' },
                    { text: `Oui, je viens √† la clinique depuis deux ans.`, type: 'mauvaise' },
                    { text: `Oui, je suis patient depuis deux ans. Mon m√©decin est le Dr Tremblay.`, type: 'acceptable' },
                    { text: `Oui, je suis suivi par le Dr Tremblay depuis deux ans. Mon num√©ro de dossier est le 45892. J'ai vu le docteur pour la derni√®re fois il y a environ six mois.`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord. C'est quoi votre nom de famille ? Je vais chercher votre dossier.`,
                    acceptable: `Tr√®s bien. Le Dr Tremblay a des disponibilit√©s la semaine prochaine. Pr√©f√©rez-vous le matin ou l'apr√®s-midi ?`,
                    ideale: `Parfait, je vois votre dossier. Le Dr Tremblay peut vous recevoir mercredi prochain √† 10h ou jeudi √† 14h30. Le rendez-vous de 30 minutes vous permettra de faire l'examen et de discuter de vos ordonnances. Quel cr√©neau vous convient ?`
                },
                feedback: {
                    mauvaise: `R√©ponse incompl√®te. Donnez le nom de votre m√©decin pour acc√©l√©rer la recherche.`,
                    acceptable: `Bonne r√©ponse. Fournir votre num√©ro de dossier acc√©l√©rerait le processus.`,
                    ideale: `Parfait ! Toutes les informations n√©cessaires sont fournies pour un traitement rapide.`
                }
            },
            {
                options: [
                    { text: `Mercredi, √ßa va.`, type: 'mauvaise' },
                    { text: `Je pr√©f√®re jeudi apr√®s-midi.`, type: 'mauvaise' },
                    { text: `Jeudi √† 14h30 me conviendrait mieux. Pouvez-vous confirmer ?`, type: 'acceptable' },
                    { text: `Je pr√©f√©rerais jeudi √† 14h30, s'il vous pla√Æt. Pourriez-vous me rappeler ce que je dois apporter pour le rendez-vous ? J'ai quelques r√©sultats d'analyses r√©centes que j'aimerais montrer au m√©decin.`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord, je vous mets jeudi. Autre chose ?`,
                    acceptable: `C'est not√© pour jeudi 14h30. N'oubliez pas votre carte d'assurance maladie. Avez-vous des questions ?`,
                    ideale: `Parfait pour jeudi 14h30. Apportez votre carte d'assurance maladie, vos ordonnances actuelles et vos r√©sultats d'analyses, le Dr Tremblay sera ravi de les consulter. Arrivez 10 minutes √† l'avance pour la mise √† jour de votre dossier. Avez-vous besoin d'autres informations ?`
                },
                feedback: {
                    mauvaise: `R√©ponse trop br√®ve. Confirmez et posez des questions pratiques.`,
                    acceptable: `Bon choix. Demander ce qu'il faut apporter serait pr√©voyant.`,
                    ideale: `Excellent ! Vous confirmez et anticipez les documents √† apporter.`
                }
            },
            {
                options: [
                    { text: `C'est gratuit avec l'assurance ?`, type: 'mauvaise' },
                    { text: `√áa co√ªte combien la visite ?`, type: 'mauvaise' },
                    { text: `La consultation est-elle couverte par la RAMQ ?`, type: 'acceptable' },
                    { text: `Pourriez-vous me confirmer que la consultation est couverte par la RAMQ ? Et si le m√©decin prescrit des analyses suppl√©mentaires, o√π puis-je les faire effectuer ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Oui, c'est couvert par la RAMQ si vous avez votre carte valide.`,
                    acceptable: `Oui, avec votre carte d'assurance maladie valide, la consultation est enti√®rement couverte. Les analyses se font au laboratoire du deuxi√®me √©tage.`,
                    ideale: `Oui, la consultation est enti√®rement couverte par la RAMQ. Si le Dr Tremblay prescrit des analyses, vous pouvez les faire directement au laboratoire du deuxi√®me √©tage, ouvert de 7h √† 15h sans rendez-vous. Les r√©sultats seront envoy√©s automatiquement au m√©decin sous 48 heures. Autre chose que je puisse faire pour vous ?`
                },
                feedback: {
                    mauvaise: `Formulation trop famili√®re. Utilisez les termes appropri√©s (RAMQ).`,
                    acceptable: `Bonne question. Anticiper les analyses montre votre pr√©voyance.`,
                    ideale: `Parfait ! Vous anticipez les √©tapes suivantes de votre parcours de soins.`
                }
            },
            {
                options: [
                    { text: `Et si je dois annuler ?`, type: 'mauvaise' },
                    { text: `Je fais comment pour annuler ?`, type: 'mauvaise' },
                    { text: `Quelle est votre politique d'annulation si j'ai un emp√™chement ?`, type: 'acceptable' },
                    { text: `Une derni√®re question : quelle est votre politique d'annulation ? Et en cas d'urgence avant le rendez-vous, est-il possible de consulter sans rendez-vous ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Il faut annuler 24 heures √† l'avance, sinon il y a des frais.`,
                    acceptable: `Nous demandons une annulation 24 heures √† l'avance par t√©l√©phone ou en ligne via le portail patient. Sinon, des frais de 50 $ s'appliquent.`,
                    ideale: `Nous demandons une annulation au moins 24 heures √† l'avance, par t√©l√©phone ou via notre portail patient en ligne. En cas d'urgence m√©dicale, notre clinique sans rendez-vous est ouverte tous les jours de 8h √† 20h. Vous pouvez aussi appeler Info-Sant√© au 811 pour √™tre orient√©. Cela r√©pond-il √† vos questions ?`
                },
                feedback: {
                    mauvaise: `Formulation trop directe. Demandez la politique de fa√ßon professionnelle.`,
                    acceptable: `Bonne question. Demander aussi les options en cas d'urgence serait complet.`,
                    ideale: `Excellent ! Vous couvrez tous les sc√©narios possibles.`
                }
            },
            {
                options: [
                    { text: `OK, merci. Au revoir.`, type: 'mauvaise' },
                    { text: `C'est parfait, merci beaucoup.`, type: 'mauvaise' },
                    { text: `Oui, tout est clair. Merci beaucoup pour ces informations, Nadia. √Ä jeudi !`, type: 'acceptable' },
                    { text: `Oui, c'est parfait. Je r√©capitule : rendez-vous jeudi √† 14h30 avec le Dr Tremblay, j'arrive 10 minutes √† l'avance avec ma carte RAMQ, mes ordonnances et mes analyses. Je vous remercie pour votre aide, Nadia. Excellente journ√©e !`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Au revoir.`,
                    acceptable: `De rien ! √Ä jeudi, bonne journ√©e.`,
                    ideale: `C'est exactement √ßa ! Je vous envoie un rappel par texto la veille. Merci de votre appel et √† jeudi. Prenez soin de vous !`
                },
                feedback: {
                    mauvaise: `Trop bref. R√©capitulez les informations importantes.`,
                    acceptable: `Bonne conclusion. Un r√©capitulatif complet serait id√©al.`,
                    ideale: `Parfait ! R√©capitulatif professionnel qui confirme tous les d√©tails.`
                }
            }
        ]
    },

    // ========== SCENARIO 3: R√âSERVER UN V√âHICULE DE LOCATION ==========
    {
        icon: 'üöó',
        title: 'R√©server un v√©hicule de location',
        context: `Vous planifiez un voyage d'une semaine en Gasp√©sie et vous avez besoin de louer une voiture. Vous appelez l'agence Auto-Location Qu√©bec pour vous renseigner sur les v√©hicules disponibles, les tarifs et les conditions de location.`,
        objective: `<strong>Votre objectif :</strong> R√©server un v√©hicule adapt√© √† vos besoins et comprendre toutes les conditions de location.`,
        opening: `Auto-Location Qu√©bec, bonjour. Ici Jean-Fran√ßois. Comment puis-je vous aider aujourd'hui ?`,
        rounds: [
            {
                options: [
                    { text: `Je veux louer une voiture.`, type: 'mauvaise' },
                    { text: `Bonjour, c'est pour une location de voiture.`, type: 'mauvaise' },
                    { text: `Bonjour, j'aimerais louer une voiture pour une semaine. Quels v√©hicules avez-vous ?`, type: 'acceptable' },
                    { text: `Bonjour Jean-Fran√ßois. Je pr√©vois un voyage en Gasp√©sie du 15 au 22 juillet et j'aurais besoin d'un v√©hicule confortable pour deux personnes avec beaucoup de bagages. Pourriez-vous me pr√©senter les options disponibles ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Pour combien de temps et √† quelles dates ? Vous √™tes combien de personnes ?`,
                    acceptable: `D'accord. Pour une semaine, nous avons des compactes, des interm√©diaires et des VUS. √Ä quelles dates exactement ?`,
                    ideale: `Excellent choix, la Gasp√©sie ! Pour deux personnes avec bagages, je vous recommande soit une interm√©diaire comme la Toyota Corolla, soit un petit VUS comme le Hyundai Tucson pour plus de confort sur les routes de montagne. Souhaitez-vous conna√Ætre les tarifs pour ces deux options ?`
                },
                feedback: {
                    mauvaise: `Trop vague. Pr√©cisez vos dates, destination et besoins.`,
                    acceptable: `Bon d√©but. Mentionner votre destination et vos besoins permettrait des recommandations personnalis√©es.`,
                    ideale: `Excellent ! Vous donnez toutes les informations n√©cessaires pour des recommandations adapt√©es.`
                }
            },
            {
                options: [
                    { text: `C'est combien le VUS ?`, type: 'mauvaise' },
                    { text: `Les prix, c'est quoi ?`, type: 'mauvaise' },
                    { text: `Quels sont les tarifs pour le VUS pour une semaine ?`, type: 'acceptable' },
                    { text: `Oui, je suis int√©ress√© par le Tucson. Pourriez-vous me donner le tarif pour la semaine compl√®te, et me pr√©ciser ce qui est inclus : kilom√©trage, assurances, √©quipements ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Le VUS, c'est environ 85 $ par jour. √áa d√©pend des options.`,
                    acceptable: `Le Tucson est √† 75 $ par jour, soit 450 $ pour sept jours avec le tarif semaine. Le kilom√©trage illimit√© est inclus. Voulez-vous ajouter des options ?`,
                    ideale: `Le Tucson est √† 450 $ pour la semaine avec kilom√©trage illimit√©. Ce tarif inclut l'assurance responsabilit√© civile de base. Je vous recommande d'ajouter l'assurance tous risques √† 15 $ par jour et le GPS √† 10 $ par jour, tr√®s utile en Gasp√©sie o√π le signal t√©l√©phonique est parfois faible. Souhaitez-vous ces options ?`
                },
                feedback: {
                    mauvaise: `Question trop directe. Demandez ce qui est inclus dans le prix.`,
                    acceptable: `Bonne question sur le tarif. Demander les inclusions √©vite les surprises.`,
                    ideale: `Parfait ! Vous demandez le tarif complet avec tous les d√©tails importants.`
                }
            },
            {
                options: [
                    { text: `Oui, je prends tout.`, type: 'mauvaise' },
                    { text: `D'accord pour l'assurance et le GPS.`, type: 'mauvaise' },
                    { text: `Oui, j'aimerais l'assurance tous risques et le GPS. Quel serait le total ?`, type: 'acceptable' },
                    { text: `Oui, je souhaiterais ajouter l'assurance tous risques et le GPS. Pourriez-vous me confirmer le montant total et me pr√©ciser ce que couvre exactement l'assurance tous risques ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `√áa vous fait 625 $ pour la semaine. C'est bon ?`,
                    acceptable: `Avec ces options, le total est de 625 $ pour la semaine. L'assurance couvre les dommages au v√©hicule sans franchise. Comment souhaitez-vous r√©cup√©rer le v√©hicule ?`,
                    ideale: `Le total est de 625 $ pour la semaine. L'assurance tous risques couvre tous les dommages au v√©hicule, y compris le pare-brise, sans aucune franchise. Vous √™tes √©galement couvert pour le vol et le vandalisme. O√π souhaitez-vous r√©cup√©rer le v√©hicule : √† notre agence du centre-ville ou √† l'a√©roport ?`
                },
                feedback: {
                    mauvaise: `Confirmation trop vague. Demandez le total et les d√©tails de couverture.`,
                    acceptable: `Bonne confirmation. Demander les d√©tails de l'assurance serait prudent.`,
                    ideale: `Excellent ! Vous vous assurez de comprendre exactement ce que vous payez.`
                }
            },
            {
                options: [
                    { text: `Au centre-ville, c'est bien.`, type: 'mauvaise' },
                    { text: `Je viendrai au centre-ville.`, type: 'mauvaise' },
                    { text: `Je pr√©f√©rerais r√©cup√©rer le v√©hicule au centre-ville. Quels sont les horaires d'ouverture ?`, type: 'acceptable' },
                    { text: `Je r√©cup√©rerai le v√©hicule √† l'agence du centre-ville le 15 juillet. Pourriez-vous me pr√©ciser vos horaires d'ouverture et les documents que je dois apporter ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord, l'agence est ouverte de 8h √† 18h. Vous venez √† quelle heure ?`,
                    acceptable: `Tr√®s bien. Notre agence est ouverte de 8h √† 18h tous les jours. Apportez votre permis de conduire et une carte de cr√©dit. Vous voulez r√©server √† quelle heure ?`,
                    ideale: `Parfait. Notre agence du 250 boulevard Ren√©-L√©vesque est ouverte de 8h √† 18h, sept jours sur sept. Apportez votre permis de conduire valide, une carte de cr√©dit √† votre nom pour le d√©p√¥t de garantie de 500 $, et une pi√®ce d'identit√©. √Ä quelle heure souhaitez-vous r√©cup√©rer le v√©hicule le 15 juillet ?`
                },
                feedback: {
                    mauvaise: `R√©ponse incompl√®te. Confirmez la date et demandez les informations pratiques.`,
                    acceptable: `Bonne question sur les horaires. Demander les documents √©vite les mauvaises surprises.`,
                    ideale: `Parfait ! Vous confirmez la date et demandez toutes les informations pratiques.`
                }
            },
            {
                options: [
                    { text: `Le matin, vers 9h.`, type: 'mauvaise' },
                    { text: `Je viendrai √† 9h.`, type: 'mauvaise' },
                    { text: `Je passerai vers 9h le 15 juillet. Et pour le retour, comment √ßa se passe ?`, type: 'acceptable' },
                    { text: `Je passerai √† 9h le 15 juillet. Concernant le retour le 22, puis-je ramener le v√©hicule apr√®s 18h si mon retour de voyage est tardif ? Y a-t-il des frais suppl√©mentaires pour un retour en dehors des heures d'ouverture ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord, 9h le 15 juillet. Le retour c'est le 22 avant 18h.`,
                    acceptable: `Parfait pour 9h. Le retour doit se faire avant 18h le 22 juillet, sinon une journ√©e suppl√©mentaire sera factur√©e. Des questions ?`,
                    ideale: `9h le 15 juillet, c'est not√©. Pour le retour, si vous revenez apr√®s 18h, vous pouvez utiliser notre bo√Æte de d√©p√¥t des cl√©s situ√©e √† l'entr√©e de l'agence, sans frais suppl√©mentaires tant que vous respectez la date du 22. Si vous avez plus d'une heure de retard, appelez-nous pour √©viter la facturation d'une journ√©e suppl√©mentaire. Avez-vous d'autres questions ?`
                },
                feedback: {
                    mauvaise: `R√©ponse incompl√®te. Renseignez-vous sur les conditions de retour.`,
                    acceptable: `Bonne question sur le retour. Anticiper un retour tardif est pr√©voyant.`,
                    ideale: `Excellent ! Vous anticipez les situations possibles et √©vitez les frais impr√©vus.`
                }
            },
            {
                options: [
                    { text: `Non, c'est bon. Merci.`, type: 'mauvaise' },
                    { text: `Non merci, c'est parfait.`, type: 'mauvaise' },
                    { text: `Non, tout est clair. Je confirme la r√©servation. Merci beaucoup pour votre aide !`, type: 'acceptable' },
                    { text: `Non, tout est parfait. Je r√©capitule : Hyundai Tucson du 15 au 22 juillet, d√©part √† 9h au 250 Ren√©-L√©vesque, retour avec d√©p√¥t des cl√©s si apr√®s 18h, total de 625 $ avec assurance tous risques et GPS. J'apporterai mon permis, une carte de cr√©dit et une pi√®ce d'identit√©. Merci beaucoup, Jean-Fran√ßois !`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord, c'est r√©serv√©. √Ä bient√¥t.`,
                    acceptable: `Parfait, votre r√©servation est confirm√©e ! Vous recevrez un courriel de confirmation. Bon voyage en Gasp√©sie !`,
                    ideale: `C'est exactement √ßa ! Je vous envoie la confirmation par courriel avec tous les d√©tails. Vous allez adorer la Gasp√©sie, le Tucson sera parfait pour les routes panoramiques ! Bon voyage et √† bient√¥t chez Auto-Location Qu√©bec !`
                },
                feedback: {
                    mauvaise: `Trop bref. R√©capitulez la r√©servation pour √©viter toute erreur.`,
                    acceptable: `Bonne confirmation. Un r√©capitulatif complet serait plus professionnel.`,
                    ideale: `Parfait ! R√©capitulatif exemplaire qui confirme tous les d√©tails de la r√©servation.`
                }
            }
        ]
    },

    // ========== SCENARIO 4: S'INFORMER SUR UNE ASSURANCE ==========
    {
        icon: 'üõ°Ô∏è',
        title: "S'informer sur une assurance habitation",
        context: `Vous venez d'emm√©nager dans un nouvel appartement et votre propri√©taire exige une preuve d'assurance locataire. Vous appelez Assurance Desjardins pour vous renseigner sur les couvertures disponibles et obtenir une soumission.`,
        objective: `<strong>Votre objectif :</strong> Comprendre les options d'assurance locataire et obtenir une soumission adapt√©e √† vos besoins.`,
        opening: `Assurance Desjardins, bonjour. Ici Caroline, conseill√®re en assurance de dommages. Comment puis-je vous aider ?`,
        rounds: [
            {
                options: [
                    { text: `J'ai besoin d'une assurance.`, type: 'mauvaise' },
                    { text: `Bonjour, c'est pour une assurance appartement.`, type: 'mauvaise' },
                    { text: `Bonjour, j'aimerais obtenir une soumission pour une assurance locataire.`, type: 'acceptable' },
                    { text: `Bonjour Caroline. Je viens d'emm√©nager dans un nouvel appartement et j'ai besoin d'une assurance locataire. Mon propri√©taire exige une preuve d'assurance. Pourriez-vous me pr√©senter vos options de couverture ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord, c'est pour un appartement ou une maison ? Vous √™tes locataire ou propri√©taire ?`,
                    acceptable: `Tr√®s bien. Pouvez-vous me donner quelques informations sur votre logement : la superficie et l'adresse ?`,
                    ideale: `Bienvenue dans votre nouveau chez-vous ! L'assurance locataire est effectivement obligatoire dans la plupart des baux. Notre formule de base couvre vos biens personnels, votre responsabilit√© civile et les frais de subsistance en cas de sinistre. Pourriez-vous me donner l'adresse de l'appartement pour commencer la soumission ?`
                },
                feedback: {
                    mauvaise: `Trop vague. Pr√©cisez votre situation et vos besoins.`,
                    acceptable: `Bon d√©but. Expliquer votre situation (nouvel emm√©nagement, exigence du propri√©taire) contextualise votre demande.`,
                    ideale: `Excellent ! Vous expliquez clairement votre situation et vos besoins.`
                }
            },
            {
                options: [
                    { text: `C'est au 450 rue Laurier.`, type: 'mauvaise' },
                    { text: `Mon appartement est au 450 rue Laurier √† Montr√©al.`, type: 'mauvaise' },
                    { text: `L'appartement est situ√© au 450 rue Laurier √† Montr√©al. C'est un 4 et demi d'environ 70 m√®tres carr√©s.`, type: 'acceptable' },
                    { text: `L'appartement est au 450 rue Laurier √† Montr√©al, appartement 302. C'est un 4 et demi d'environ 70 m√®tres carr√©s, au troisi√®me √©tage d'un immeuble de 1985 avec d√©tecteurs de fum√©e. J'estime la valeur de mes biens √† environ 25 000 $.`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord. C'est quel type de logement ? Un studio, un 3 et demi... ?`,
                    acceptable: `Tr√®s bien, c'est not√©. √Ä combien estimez-vous la valeur de vos biens personnels : meubles, √©lectroniques, v√™tements ?`,
                    ideale: `Parfait, j'ai toutes les informations de base. Pour 25 000 $ de biens, je vous recommande notre formule Confort qui inclut le remplacement √† neuf pour vos appareils √©lectroniques. Souhaitez-vous conna√Ætre les diff√©rentes options de couverture et leurs tarifs ?`
                },
                feedback: {
                    mauvaise: `Information incompl√®te. Donnez plus de d√©tails sur le logement.`,
                    acceptable: `Bonnes informations. Estimer la valeur de vos biens acc√©l√©rerait la soumission.`,
                    ideale: `Parfait ! Vous fournissez toutes les informations n√©cessaires en une seule fois.`
                }
            },
            {
                options: [
                    { text: `Oui, c'est combien ?`, type: 'mauvaise' },
                    { text: `Quels sont les prix ?`, type: 'mauvaise' },
                    { text: `Oui, pourriez-vous me pr√©senter les diff√©rentes formules et leurs tarifs ?`, type: 'acceptable' },
                    { text: `Oui, j'aimerais comprendre les diff√©rences entre vos formules. Qu'est-ce qui distingue la formule de base de la formule Confort, et quelle est la couverture en responsabilit√© civile incluse ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `La formule de base est √† environ 25 $ par mois. √áa d√©pend des options.`,
                    acceptable: `Notre formule Base est √† 22 $ par mois, la formule Confort √† 32 $. La Confort inclut le remplacement √† neuf et une franchise r√©duite. Quelle formule vous int√©resse ?`,
                    ideale: `La formule Base √† 22 $ par mois couvre vos biens √† leur valeur d√©pr√©ci√©e avec une franchise de 500 $. La formule Confort √† 32 $ offre le remplacement √† neuf, une franchise de 250 $, et couvre aussi les d√©g√¢ts d'eau. Les deux incluent 2 millions en responsabilit√© civile. Pour votre situation, je recommande la Confort. Avez-vous des questions sur les protections sp√©cifiques ?`
                },
                feedback: {
                    mauvaise: `Question trop directe. Demandez les d√©tails des couvertures.`,
                    acceptable: `Bonne question. Demander les diff√©rences pr√©cises aide √† faire un choix √©clair√©.`,
                    ideale: `Excellent ! Vous posez les bonnes questions pour comprendre ce que vous achetez.`
                }
            },
            {
                options: [
                    { text: `C'est quoi les d√©g√¢ts d'eau exactement ?`, type: 'mauvaise' },
                    { text: `Les d√©g√¢ts d'eau, √ßa couvre quoi ?`, type: 'mauvaise' },
                    { text: `Pourriez-vous pr√©ciser ce que couvre la protection contre les d√©g√¢ts d'eau ?`, type: 'acceptable' },
                    { text: `La protection contre les d√©g√¢ts d'eau m'int√©resse particuli√®rement. Pourriez-vous pr√©ciser les types de sinistres couverts ? Et y a-t-il des exclusions dont je devrais √™tre conscient ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Les d√©g√¢ts d'eau, c'est si vous avez une fuite ou un d√©g√¢t du voisin du dessus.`,
                    acceptable: `La protection couvre les fuites de plomberie, les refoulements d'√©gouts et les infiltrations par le toit. Les inondations par crue sont exclues.`,
                    ideale: `Excellente question ! La protection couvre les fuites de plomberie, les refoulements d'√©gouts, les infiltrations par le toit et m√™me les d√©g√¢ts caus√©s par un voisin. Les exclusions sont les inondations par crue de cours d'eau et les dommages graduels comme la moisissure due √† un probl√®me non signal√©. Pour un troisi√®me √©tage, vous √™tes bien prot√©g√©. Souhaitez-vous que je finalise la soumission avec la formule Confort ?`
                },
                feedback: {
                    mauvaise: `Formulation trop famili√®re. Utilisez un registre plus soutenu.`,
                    acceptable: `Bonne question de clarification. Demander les exclusions serait prudent.`,
                    ideale: `Parfait ! Vous demandez les d√©tails et les exclusions pour √©viter les mauvaises surprises.`
                }
            },
            {
                options: [
                    { text: `Oui, √ßa me va.`, type: 'mauvaise' },
                    { text: `D'accord, je prends la Confort.`, type: 'mauvaise' },
                    { text: `Oui, la formule Confort me convient. Comment puis-je obtenir ma preuve d'assurance pour le propri√©taire ?`, type: 'acceptable' },
                    { text: `Oui, je souhaiterais la formule Confort √† 32 $ par mois. Pourriez-vous m'expliquer les modalit√©s de paiement et me confirmer que je recevrai une attestation d'assurance pour mon propri√©taire rapidement ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Tr√®s bien. Je vais avoir besoin de vos coordonn√©es pour finaliser.`,
                    acceptable: `Parfait ! Je peux vous envoyer l'attestation par courriel d√®s que le paiement est effectu√©. Vous payez mensuellement ou annuellement ?`,
                    ideale: `Excellent choix ! Pour le paiement, vous pouvez choisir mensuel √† 32 $ ou annuel √† 370 $, soit un mois gratuit. L'attestation d'assurance sera envoy√©e par courriel dans l'heure suivant votre paiement, que vous pourrez transmettre directement √† votre propri√©taire. Quelle option de paiement pr√©f√©rez-vous ?`
                },
                feedback: {
                    mauvaise: `R√©ponse trop br√®ve. Demandez les d√©tails sur les prochaines √©tapes.`,
                    acceptable: `Bonne question sur l'attestation. Demander les options de paiement serait complet.`,
                    ideale: `Excellent ! Vous confirmez votre choix et demandez toutes les informations pratiques.`
                }
            },
            {
                options: [
                    { text: `Annuel, c'est mieux.`, type: 'mauvaise' },
                    { text: `Je vais payer √† l'ann√©e alors.`, type: 'mauvaise' },
                    { text: `Le paiement annuel me convient pour b√©n√©ficier de la r√©duction. Merci pour ces explications, Caroline.`, type: 'acceptable' },
                    { text: `Je choisis le paiement annuel √† 370 $ pour b√©n√©ficier du mois gratuit. Je r√©capitule : formule Confort avec 25 000 $ de couverture, responsabilit√© civile de 2 millions, franchise de 250 $, et attestation envoy√©e sous une heure. Je vous remercie pour ces explications d√©taill√©es, Caroline !`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord. Je vais prendre vos informations de paiement.`,
                    acceptable: `Excellent, c'est une bonne d√©cision ! Je pr√©pare les documents. Bienvenue chez Desjardins !`,
                    ideale: `C'est exactement √ßa, vous avez tout compris ! Je pr√©pare la police et vous recevrez l'attestation sous une heure. Votre couverture d√©bute d√®s le paiement. Bienvenue chez Desjardins et bon emm√©nagement dans votre nouvel appartement !`
                },
                feedback: {
                    mauvaise: `R√©ponse trop br√®ve. Confirmez les d√©tails de votre police.`,
                    acceptable: `Bonne d√©cision. Un r√©capitulatif montrerait votre compr√©hension.`,
                    ideale: `Parfait ! R√©capitulatif complet qui confirme votre compr√©hension de la police.`
                }
            }
        ]
    },

    // ========== SCENARIO 5: R√âSERVER UNE TABLE AU RESTAURANT ==========
    {
        icon: 'üçΩÔ∏è',
        title: 'R√©server une table au restaurant',
        context: `Vous organisez un d√Æner d'anniversaire pour votre conjoint dans un restaurant r√©put√© du Vieux-Montr√©al. Vous appelez le restaurant ¬´ Le Saint-Urbain ¬ª pour r√©server une table et vous renseigner sur leurs menus et services sp√©ciaux.`,
        objective: `<strong>Votre objectif :</strong> R√©server une table pour une occasion sp√©ciale et organiser les d√©tails de la soir√©e.`,
        opening: `Restaurant Le Saint-Urbain, bonsoir. Ici Mathieu, comment puis-je vous aider ?`,
        rounds: [
            {
                options: [
                    { text: `Je veux r√©server une table.`, type: 'mauvaise' },
                    { text: `Bonsoir, c'est pour une r√©servation.`, type: 'mauvaise' },
                    { text: `Bonsoir, j'aimerais r√©server une table pour samedi soir. Avez-vous des disponibilit√©s ?`, type: 'acceptable' },
                    { text: `Bonsoir Mathieu. Je souhaiterais r√©server une table pour samedi soir prochain afin de c√©l√©brer l'anniversaire de mon conjoint. Nous serions quatre personnes. Avez-vous des disponibilit√©s et peut-√™tre une table dans un coin tranquille ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Pour combien de personnes et quel soir ?`,
                    acceptable: `Samedi soir, oui, nous avons de la place. Pour combien de personnes et √† quelle heure ?`,
                    ideale: `Quel beau projet ! Pour un anniversaire avec quatre personnes samedi soir, je peux vous proposer notre table pr√®s de la chemin√©e, tr√®s intime, ou celle avec vue sur la terrasse int√©rieure. Nous avons des disponibilit√©s √† 18h30 ou 20h30. Quelle option vous conviendrait ?`
                },
                feedback: {
                    mauvaise: `Trop direct. Pr√©cisez la date, le nombre de convives et l'occasion.`,
                    acceptable: `Bon d√©but. Mentionner l'occasion sp√©ciale permet au restaurant de mieux vous servir.`,
                    ideale: `Excellent ! Vous donnez tous les d√©tails importants pour une r√©servation personnalis√©e.`
                }
            },
            {
                options: [
                    { text: `20h30, c'est bien.`, type: 'mauvaise' },
                    { text: `Je pr√©f√®re 20h30.`, type: 'mauvaise' },
                    { text: `La table pr√®s de la chemin√©e √† 20h30 serait parfaite. Combien de temps avons-nous pour le repas ?`, type: 'acceptable' },
                    { text: `La table pr√®s de la chemin√©e √† 20h30 serait id√©ale pour cr√©er une ambiance intime. Pourriez-vous me pr√©ciser la dur√©e que nous pouvons pr√©voir pour le repas et me parler de vos menus ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord pour 20h30. Vous voulez r√©server au nom de qui ?`,
                    acceptable: `Parfait. Pour un d√Æner de quatre services, comptez environ deux heures et demie. Nous ne vous presserons pas, surtout pour une occasion sp√©ciale. Connaissez-vous notre menu ?`,
                    ideale: `Excellent choix ! La table pr√®s de la chemin√©e est r√©serv√©e pour vous √† 20h30. Pour un anniversaire, je vous recommande notre menu d√©couverte √† sept services avec accords mets et vins, pr√©voir trois heures pour une exp√©rience compl√®te. Nous avons aussi un menu √† la carte si vous pr√©f√©rez. Avez-vous des pr√©f√©rences ou des restrictions alimentaires √† signaler ?`
                },
                feedback: {
                    mauvaise: `R√©ponse trop br√®ve. Renseignez-vous sur l'exp√©rience propos√©e.`,
                    acceptable: `Bonne question sur la dur√©e. Demander les menus montrerait votre int√©r√™t.`,
                    ideale: `Parfait ! Vous posez des questions pertinentes pour planifier la soir√©e.`
                }
            },
            {
                options: [
                    { text: `Non, pas d'allergies.`, type: 'mauvaise' },
                    { text: `Mon conjoint n'aime pas le poisson.`, type: 'mauvaise' },
                    { text: `Mon conjoint a une allergie aux fruits de mer. Pourriez-vous adapter le menu en cons√©quence ?`, type: 'acceptable' },
                    { text: `Oui, mon conjoint a une allergie aux fruits de mer qu'il faudra prendre en compte. Par ailleurs, nous aimerions le menu d√©couverte. Serait-il possible d'adapter les plats concern√©s et pourriez-vous me donner une id√©e du prix par personne avec les accords vins ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord. Et vous voulez le menu √† la carte ou le menu d√©couverte ?`,
                    acceptable: `Bien not√© pour l'allergie aux fruits de mer, notre chef adaptera les plats. Le menu d√©couverte est √† 125 $ par personne. Voulez-vous les accords vins ?`,
                    ideale: `Absolument, c'est not√© avec la plus grande attention. Notre chef remplacera les plats √† base de fruits de mer par des alternatives de m√™me qualit√©. Le menu d√©couverte est √† 125 $ par personne, et avec les accords vins s√©lectionn√©s par notre sommelier, comptez 185 $ par personne. Souhaitez-vous que nous pr√©parions quelque chose de sp√©cial pour l'anniversaire ?`
                },
                feedback: {
                    mauvaise: `Information incompl√®te. Mentionnez clairement les allergies pour la s√©curit√©.`,
                    acceptable: `Bonne pr√©cision sur l'allergie. Demander les tarifs √©vite les surprises.`,
                    ideale: `Excellent ! Vous communiquez l'allergie clairement et demandez tous les d√©tails financiers.`
                }
            },
            {
                options: [
                    { text: `Oui, un g√¢teau ce serait bien.`, type: 'mauvaise' },
                    { text: `Vous pouvez faire quelque chose pour l'anniversaire ?`, type: 'mauvaise' },
                    { text: `Oui, pourriez-vous pr√©voir un dessert d'anniversaire avec une bougie ?`, type: 'acceptable' },
                    { text: `Ce serait merveilleux ! Pourriez-vous pr√©voir un dessert d'anniversaire personnalis√© avec le pr√©nom de mon conjoint ? Je voudrais aussi savoir s'il est possible d'apporter une bouteille de champagne sp√©ciale que j'ai achet√©e pour l'occasion.`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Oui, on peut faire un dessert sp√©cial. Pas de probl√®me.`,
                    acceptable: `Avec plaisir ! Notre p√¢tissier pr√©parera un dessert avec une bougie et le pr√©nom de votre conjoint. Comment s'appelle la personne ?`,
                    ideale: `Bien s√ªr ! Notre p√¢tissier pr√©parera un dessert personnalis√© au pr√©nom de votre conjoint, servi avec une bougie et nos v≈ìux. Pour le champagne, vous pouvez tout √† fait apporter votre bouteille, nous facturons 35 $ de frais de service qui incluent les coupes en cristal et le service. Quel est le pr√©nom pour le dessert ?`
                },
                feedback: {
                    mauvaise: `Formulation vague. Soyez pr√©cis dans votre demande.`,
                    acceptable: `Bonne id√©e pour le dessert. Un √©l√©ment surprise suppl√©mentaire marquerait l'occasion.`,
                    ideale: `Parfait ! Vous personnalisez l'exp√©rience et demandez les informations pratiques.`
                }
            },
            {
                options: [
                    { text: `C'est Marie.`, type: 'mauvaise' },
                    { text: `Le pr√©nom, c'est Marie.`, type: 'mauvaise' },
                    { text: `Le pr√©nom est Marie. Pourriez-vous garder le dessert secret jusqu'au moment de le servir ?`, type: 'acceptable' },
                    { text: `Le pr√©nom est Marie. Je vous fais confiance pour garder la surprise ! Pourriez-vous servir le dessert avec une coupe de mon champagne plut√¥t qu'apr√®s, et peut-√™tre tamiser l√©g√®rement les lumi√®res √† ce moment-l√† ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Marie, c'est not√©. La r√©servation est au nom de qui ?`,
                    acceptable: `Marie, c'est not√©. Nous serons tr√®s discrets et nous vous ferons un petit signe avant d'apporter le dessert. Puis-je avoir votre nom pour la r√©servation ?`,
                    ideale: `Marie, c'est not√© avec tous les d√©tails ! Nous servirons le champagne avec le dessert, et notre √©quipe tamisera subtilement l'√©clairage pour cr√©er un moment magique. Je note votre num√©ro pour vous pr√©venir discr√®tement quand nous serons pr√™ts. √Ä quel nom puis-je faire la r√©servation ?`
                },
                feedback: {
                    mauvaise: `R√©ponse trop br√®ve. Ajoutez des demandes pour personnaliser le moment.`,
                    acceptable: `Bonne id√©e de garder la surprise. Demander une mise en sc√®ne rendrait le moment encore plus sp√©cial.`,
                    ideale: `Excellent ! Vous orchestrez tous les d√©tails pour cr√©er un moment m√©morable.`
                }
            },
            {
                options: [
                    { text: `Dupont. Merci, au revoir.`, type: 'mauvaise' },
                    { text: `La r√©servation est au nom de Dupont.`, type: 'mauvaise' },
                    { text: `La r√©servation est au nom de Dupont. Merci beaucoup pour votre aide, Mathieu. √Ä samedi !`, type: 'acceptable' },
                    { text: `La r√©servation est au nom de Dupont, et mon num√©ro est le 514-555-0123. Je r√©capitule : samedi √† 20h30, table pr√®s de la chemin√©e pour quatre personnes, menu d√©couverte avec accords vins, adaptation pour l'allergie aux fruits de mer de Marie, dessert surprise avec champagne et lumi√®res tamis√©es. Je vous remercie infiniment pour votre aide, Mathieu. Ce sera une soir√©e inoubliable !`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Dupont, c'est not√©. √Ä samedi.`,
                    acceptable: `Parfait, Monsieur Dupont ! Tout est en place pour une belle soir√©e. √Ä samedi et joyeux anniversaire √† Marie !`,
                    ideale: `Tout est parfait, Monsieur Dupont ! Je vous envoie une confirmation par courriel avec tous les d√©tails. Notre √©quipe a h√¢te de vous accueillir samedi pour cr√©er une soir√©e magique pour Marie. √Ä tr√®s bient√¥t et joyeux anniversaire √† elle !`
                },
                feedback: {
                    mauvaise: `Conclusion trop abrupte pour une occasion sp√©ciale.`,
                    acceptable: `Bonne conclusion. Un r√©capitulatif garantirait que tout est en ordre.`,
                    ideale: `Parfait ! R√©capitulatif complet qui assure le succ√®s de la soir√©e.`
                }
            }
        ]
    }
];

// ============================================================
// APPLICATION
// ============================================================
const App = {
    voiceEnabled: false,
    apiKey: null,
    scenario: null,
    round: 0,
    selected: null,
    selectedText: null,
    lastType: null,
    lastResponse: null,
    lastQuestion: null,
    scores: { ideale: 0, acceptable: 0, mauvaise: 0 },
    textHidden: false,

    init() {
        this.renderScenarioList();
        const savedKey = sessionStorage.getItem('xi_key');
        if (savedKey) {
            document.getElementById('apiKey').value = savedKey;
            this.apiKey = savedKey;
            this.voiceEnabled = true;
            document.getElementById('apiStatus').textContent = 'üîä Voix activ√©e';
            document.getElementById('apiStatus').classList.add('active');
        }
    },

    renderScenarioList() {
        const container = document.getElementById('scenarioList');
        container.innerHTML = SCENARIOS.map((s, i) => `
            <div class="scenario-card" onclick="App.selectScenario(${i})">
                <div class="scenario-icon">${s.icon}</div>
                <div class="scenario-info">
                    <h3>${s.title}</h3>
                    <p>${s.context.substring(0, 100)}...</p>
                </div>
            </div>
        `).join('');
    },

    async activateVoice() {
        const key = document.getElementById('apiKey').value.trim();
        if (!key) return alert('Entrez une cl√© API.');
        try {
            const res = await fetch('https://api.elevenlabs.io/v1/user', { headers: { 'xi-api-key': key } });
            if (res.ok) {
                this.apiKey = key;
                this.voiceEnabled = true;
                sessionStorage.setItem('xi_key', key);
                document.getElementById('apiStatus').textContent = 'üîä Voix activ√©e';
                document.getElementById('apiStatus').classList.add('active');
            } else {
                alert('Cl√© invalide.');
            }
        } catch (e) { alert('Erreur de connexion.'); }
    },

    async speak(text) {
        if (!this.voiceEnabled || !this.apiKey) return;
        try {
            const res = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'xi-api-key': this.apiKey },
                body: JSON.stringify({ text, model_id: 'eleven_multilingual_v2', voice_settings: { stability: 0.5, similarity_boost: 0.75 } })
            });
            if (res.ok) {
                const blob = await res.blob();
                new Audio(URL.createObjectURL(blob)).play();
            }
        } catch (e) { console.log('Audio error:', e); }
    },

    playCurrentAudio() {
        const text = this.round === 0 ? this.scenario.opening : this.lastResponse;
        if (text) this.speak(text);
    },

    toggleText() {
        this.textHidden = !this.textHidden;
        const textEl = document.getElementById('interviewerText');
        const btn = document.getElementById('toggleTextBtn');
        
        if (this.textHidden) {
            textEl.classList.add('hidden');
            btn.textContent = 'üëÅÔ∏è Afficher le texte';
        } else {
            textEl.classList.remove('hidden');
            btn.textContent = 'üëÅÔ∏è Masquer le texte';
        }
    },

    showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    },

    selectScenario(index) {
        this.scenario = SCENARIOS[index];
        this.round = 0;
        this.scores = { ideale: 0, acceptable: 0, mauvaise: 0 };
        this.selected = null;
        this.selectedText = null;
        this.lastType = null;
        this.lastResponse = null;
        this.lastQuestion = null;

        document.getElementById('ctxTitle').innerHTML = `${this.scenario.icon} ${this.scenario.title}`;
        document.getElementById('ctxText').textContent = this.scenario.context;
        document.getElementById('ctxObjective').innerHTML = this.scenario.objective;
        this.showScreen('screenContext');
    },

    startDialogue() {
        this.showScreen('screenDialogue');
        this.renderRound();
    },

    backToMenu() { this.showScreen('screenSelect'); },

    restart() {
        this.round = 0;
        this.scores = { ideale: 0, acceptable: 0, mauvaise: 0 };
        this.selected = null;
        this.selectedText = null;
        this.lastType = null;
        this.lastResponse = null;
        this.lastQuestion = null;
        this.showScreen('screenDialogue');
        this.renderRound();
    },

    renderRound() {
        this.selected = null;
        this.lastType = null;

        const total = this.scenario.rounds.length;
        document.getElementById('progressBar').innerHTML =
            this.scenario.rounds.map((_, i) =>
                `<div class="progress-step ${i < this.round ? 'done' : ''} ${i === this.round ? 'current' : ''}"></div>`
            ).join('') + `<span class="progress-text">${this.round + 1}/${total}</span>`;

        // Show user's previous question (rounds 1+)
        const userBox = document.getElementById('userBox');
        if (this.round > 0 && this.lastQuestion) {
            document.getElementById('userText').textContent = `¬´ ${this.lastQuestion} ¬ª`;
            userBox.style.display = 'block';
        } else {
            userBox.style.display = 'none';
        }

        // Show either opening (round 0) or last response (rounds 1+)
        const displayText = this.round === 0 ? this.scenario.opening : this.lastResponse;
        const textEl = document.getElementById('interviewerText');
        textEl.textContent = `¬´ ${displayText} ¬ª`;
        
        // Apply text visibility state
        const toggleBtn = document.getElementById('toggleTextBtn');
        if (this.textHidden) {
            textEl.classList.add('hidden');
            toggleBtn.textContent = 'üëÅÔ∏è Afficher le texte';
        } else {
            textEl.classList.remove('hidden');
            toggleBtn.textContent = 'üëÅÔ∏è Masquer le texte';
        }

        // Shuffle options
        const r = this.scenario.rounds[this.round];
        const shuffled = [...r.options].sort(() => Math.random() - 0.5);
        document.getElementById('questionList').innerHTML = shuffled.map((opt, i) => `
            <div class="question-item" data-type="${opt.type}" onclick="App.selectOption(this)">
                <div class="question-radio"></div>
                <div class="question-content">¬´ ${opt.text} ¬ª</div>
            </div>
        `).join('');

        document.getElementById('btnValidate').disabled = true;
        document.getElementById('feedbackBox').classList.remove('visible', 'mauvaise', 'acceptable', 'ideale');
        document.getElementById('questionsSection').style.display = 'block';
        document.getElementById('validateRow').style.display = 'flex';

        if (this.voiceEnabled) setTimeout(() => this.playCurrentAudio(), 400);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    },

    selectOption(el) {
        document.querySelectorAll('.question-item').forEach(q => q.classList.remove('selected'));
        el.classList.add('selected');
        this.selected = el.dataset.type;
        this.selectedText = el.querySelector('.question-content').textContent.replace(/[¬´¬ª]/g, '').trim();
        document.getElementById('btnValidate').disabled = false;
    },

    validate() {
        if (!this.selected) return;

        const type = this.selected;
        this.lastType = type;
        this.scores[type]++;

        const r = this.scenario.rounds[this.round];
        const response = r.responses[type];
        const feedback = r.feedback[type];

        // Store question and response for next round (only if not mauvaise)
        if (type !== 'mauvaise') {
            this.lastQuestion = this.selectedText;
            this.lastResponse = response;
        }

        const icons = { mauvaise: '‚ùå', acceptable: '‚ö†Ô∏è', ideale: '‚úÖ' };
        const titles = { mauvaise: 'Question inappropri√©e', acceptable: 'Correct, mais basique', ideale: 'Excellent !' };
        document.getElementById('feedbackHeader').innerHTML = `${icons[type]} ${titles[type]}`;
        
        // For mauvaise, show the awkward response so user understands the consequence
        if (type === 'mauvaise') {
            document.getElementById('feedbackContent').innerHTML = `
                <p style="margin-bottom: 1rem;"><strong>L'interlocuteur r√©pond :</strong></p>
                <p style="font-style: italic; margin-bottom: 1rem;">¬´ ${response} ¬ª</p>
                <p>${feedback}</p>
            `;
        } else {
            document.getElementById('feedbackContent').innerHTML = `<p>${feedback}</p>`;
        }

        const btn = document.getElementById('btnContinue');
        if (type === 'mauvaise') {
            btn.textContent = 'Essayer encore ‚Üí';
        } else if (this.round < this.scenario.rounds.length - 1) {
            btn.textContent = 'Continuer ‚Üí';
        } else {
            btn.textContent = 'Voir les r√©sultats ‚Üí';
        }

        document.getElementById('feedbackBox').className = `feedback-box visible ${type}`;
        document.getElementById('questionsSection').style.display = 'none';
        document.getElementById('validateRow').style.display = 'none';
    },

    continue() {
        if (this.lastType === 'mauvaise') {
            this.renderRound();
        } else if (this.round < this.scenario.rounds.length - 1) {
            this.round++;
            this.renderRound();
        } else {
            this.showResults();
        }
    },

    showResults() {
        document.getElementById('resultsTitle').textContent = this.scenario.title;
        document.getElementById('scoreIdeale').textContent = this.scores.ideale;
        document.getElementById('scoreAcceptable').textContent = this.scores.acceptable;
        document.getElementById('scoreMauvaise').textContent = this.scores.mauvaise;

        const total = this.scores.ideale + this.scores.acceptable;
        const ratio = total > 0 ? this.scores.ideale / total : 0;
        let level = '5-6';
        if (ratio >= 0.8 && this.scores.mauvaise === 0) level = '8-9';
        else if (ratio >= 0.6) level = '7-8';
        else if (ratio >= 0.4) level = '6-7';
        document.getElementById('nclcLevel').textContent = level;

        const tips = [];
        if (this.scores.mauvaise > 0) tips.push('√âvitez les formulations vagues ou trop informelles.');
        if (this.scores.acceptable > this.scores.ideale) tips.push('Anticipez les d√©tails importants dans vos questions.');
        if (this.scores.ideale >= 3) tips.push('Excellent travail sur la pr√©cision et le registre formel !');
        tips.push('Continuez √† pratiquer pour automatiser les formulations NCLC 8.');
        document.getElementById('tipsList').innerHTML = tips.map(t => `<li>${t}</li>`).join('');

        this.showScreen('screenResults');
    }
};

document.addEventListener('DOMContentLoaded', () => App.init());
</script>
</body>
</html>
