<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEF Canada ‚Äî Expression orale NCLC 8</title>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:opsz,wght@8..60,400;8..60,600;8..60,700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f1419;
            --bg-secondary: #1a2332;
            --bg-tertiary: #243044;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            font-family: 'Source Serif 4', serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; }

        .level-badge {
            display: inline-block;
            background: var(--accent-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 0.75rem;
        }

        /* API Panel */
        .api-panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .api-panel input {
            flex: 1;
            min-width: 200px;
            padding: 0.6rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: monospace;
        }

        .api-panel input:focus { outline: none; border-color: var(--accent-blue); }

        .api-status {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            background: var(--bg-tertiary);
        }

        .api-status.active { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-primary:hover:not(:disabled) { background: #2563eb; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-small { padding: 0.5rem 1rem; font-size: 0.85rem; }

        /* Screens */
        .screen { display: none; }
        .screen.active { display: block; }

        /* Scenario Cards */
        .scenario-grid { display: grid; gap: 1rem; }

        .scenario-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .scenario-card:hover { border-color: var(--accent-blue); transform: translateY(-2px); }

        .scenario-icon {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: 12px;
        }

        .scenario-info h3 { font-size: 1.1rem; margin-bottom: 0.25rem; }
        .scenario-info p { font-size: 0.9rem; color: var(--text-secondary); }

        /* Context Screen */
        .context-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
        }

        .context-title { font-family: 'Source Serif 4', serif; font-size: 1.5rem; margin-bottom: 1.5rem; }

        .context-text {
            text-align: left;
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .context-objective {
            text-align: left;
            padding: 1rem 1.5rem;
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid var(--accent-blue);
            border-radius: 0 8px 8px 0;
            margin-bottom: 2rem;
        }

        /* Dialogue Screen */
        .progress-bar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 10px;
        }

        .progress-step { flex: 1; height: 6px; background: var(--bg-tertiary); border-radius: 3px; }
        .progress-step.done { background: var(--accent-green); }
        .progress-step.current { background: var(--accent-blue); }
        .progress-text { font-size: 0.85rem; color: var(--text-secondary); white-space: nowrap; margin-left: 0.5rem; }

        .user-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .user-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .user-text {
            font-family: 'Source Serif 4', serif;
            font-size: 1.1rem;
            line-height: 1.7;
            padding: 1.25rem;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border-left: 3px solid var(--accent-green);
            color: var(--text-secondary);
        }

        .interviewer-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .interviewer-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .interviewer-text {
            font-family: 'Source Serif 4', serif;
            font-size: 1.2rem;
            line-height: 1.7;
            padding: 1.25rem;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border-left: 3px solid var(--accent-blue);
        }

        .audio-btn {
            margin-top: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
        }

        .audio-btn:hover { border-color: var(--accent-blue); color: var(--accent-blue); }

        .audio-controls { display: flex; gap: 0.75rem; margin-top: 1rem; flex-wrap: wrap; }

        .interviewer-text.hidden {
            background: var(--bg-tertiary);
            color: transparent;
            user-select: none;
            position: relative;
        }

        .interviewer-text.hidden::after {
            content: 'üëÅÔ∏è Cliquez sur "Afficher le texte" pour voir la transcription';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-muted);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.9rem;
            font-style: normal;
            white-space: nowrap;
        }

        /* Questions */
        .questions-section { margin-bottom: 1.5rem; }
        .questions-section h3 { font-size: 1rem; color: var(--text-secondary); margin-bottom: 1rem; font-weight: 500; }

        .question-list { display: flex; flex-direction: column; gap: 0.75rem; }

        .question-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 1.25rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .question-item:hover { border-color: var(--accent-blue); background: var(--bg-tertiary); }
        .question-item.selected { border-color: var(--accent-blue); background: rgba(59, 130, 246, 0.1); }

        .question-radio {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 2px;
        }

        .question-item.selected .question-radio { border-color: var(--accent-blue); background: var(--accent-blue); }
        .question-item.selected .question-radio::after { content: ''; width: 8px; height: 8px; background: white; border-radius: 50%; }

        .question-content { font-size: 1rem; line-height: 1.6; }

        .validate-row { display: flex; justify-content: flex-end; margin-bottom: 1.5rem; }

        /* Feedback */
        .feedback-box {
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            display: none;
        }

        .feedback-box.visible { display: block; }

        .feedback-box.mauvaise { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--accent-red); }
        .feedback-box.acceptable { background: rgba(245, 158, 11, 0.1); border: 1px solid var(--accent-yellow); }
        .feedback-box.ideale { background: rgba(16, 185, 129, 0.1); border: 1px solid var(--accent-green); }

        .feedback-header { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; margin-bottom: 0.75rem; }
        .feedback-box.mauvaise .feedback-header { color: var(--accent-red); }
        .feedback-box.acceptable .feedback-header { color: var(--accent-yellow); }
        .feedback-box.ideale .feedback-header { color: var(--accent-green); }

        .feedback-content { color: var(--text-secondary); line-height: 1.7; margin-bottom: 1rem; }
        .feedback-actions { display: flex; gap: 0.75rem; }

        /* Results */
        .results-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
        }

        .results-box h2 { font-family: 'Source Serif 4', serif; font-size: 1.75rem; margin-bottom: 0.5rem; }
        .results-subtitle { color: var(--text-secondary); margin-bottom: 1.5rem; }

        .score-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 2rem; }

        .score-card { padding: 1.25rem; background: var(--bg-tertiary); border-radius: 12px; }
        .score-card .num { font-size: 2rem; font-weight: 700; }
        .score-card .label { font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem; }
        .score-card.green .num { color: var(--accent-green); }
        .score-card.yellow .num { color: var(--accent-yellow); }
        .score-card.red .num { color: var(--accent-red); }

        .nclc-box { background: var(--bg-tertiary); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; }
        .nclc-box .level { font-size: 2.5rem; font-weight: 700; color: var(--accent-blue); }
        .nclc-box .label { color: var(--text-secondary); font-size: 0.9rem; }

        .tips-box { text-align: left; background: var(--bg-tertiary); padding: 1.25rem; border-radius: 12px; margin-bottom: 1.5rem; }
        .tips-box h4 { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.75rem; }
        .tips-box ul { list-style: none; }
        .tips-box li { padding: 0.5rem 0; padding-left: 1.5rem; position: relative; color: var(--text-secondary); }
        .tips-box li::before { content: '‚Üí'; position: absolute; left: 0; color: var(--accent-blue); }

        .results-actions { display: flex; gap: 1rem; justify-content: center; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>TEF Canada ‚Äî Expression orale</h1>
            <p class="subtitle">Section A : Obtenir des renseignements</p>
            <span class="level-badge">Niveau cible : NCLC 8</span>
        </header>

        <div class="api-panel">
            <span>üîë</span>
            <input type="password" id="apiKey" placeholder="Cl√© API ElevenLabs">
            <button class="btn btn-primary btn-small" onclick="App.activateVoice()">Activer</button>
            <div class="api-status" id="apiStatus">üîá Voix d√©sactiv√©e</div>
        </div>

        <!-- Screen: Scenario Selection -->
        <div class="screen active" id="screenSelect">
            <h2 style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 1rem;">Choisissez un sc√©nario :</h2>
            <div class="scenario-grid" id="scenarioList"></div>
        </div>

        <!-- Screen: Context -->
        <div class="screen" id="screenContext">
            <div class="context-box">
                <div class="context-title" id="ctxTitle"></div>
                <div class="context-text" id="ctxText"></div>
                <div class="context-objective" id="ctxObjective"></div>
                <button class="btn btn-primary" onclick="App.startDialogue()">Commencer l'appel ‚ñ∂</button>
            </div>
        </div>

        <!-- Screen: Dialogue -->
        <div class="screen" id="screenDialogue">
            <div class="progress-bar" id="progressBar"></div>

            <div class="user-box" id="userBox" style="display: none;">
                <div class="user-label">üó£Ô∏è Vous :</div>
                <div class="user-text" id="userText"></div>
            </div>

            <div class="interviewer-box">
                <div class="interviewer-label">üéß L'interlocuteur :</div>
                <div class="interviewer-text" id="interviewerText"></div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="App.playCurrentAudio()">üîä √âcouter</button>
                    <button class="audio-btn" id="toggleTextBtn" onclick="App.toggleText()">üëÅÔ∏è Masquer le texte</button>
                </div>
            </div>

            <div class="questions-section" id="questionsSection">
                <h3>Choisissez votre question :</h3>
                <div class="question-list" id="questionList"></div>
            </div>

            <div class="validate-row" id="validateRow">
                <button class="btn btn-primary" id="btnValidate" onclick="App.validate()" disabled>Valider ‚ñ∂</button>
            </div>

            <div class="feedback-box" id="feedbackBox">
                <div class="feedback-header" id="feedbackHeader"></div>
                <div class="feedback-content" id="feedbackContent"></div>
                <div class="feedback-actions">
                    <button class="btn btn-primary" id="btnContinue" onclick="App.continue()">Continuer ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Screen: Results -->
        <div class="screen" id="screenResults">
            <div class="results-box">
                <h2>üìä R√©sultats</h2>
                <p class="results-subtitle" id="resultsTitle"></p>
                <div class="score-grid">
                    <div class="score-card green"><div class="num" id="scoreIdeale">0</div><div class="label">‚úÖ Id√©ales</div></div>
                    <div class="score-card yellow"><div class="num" id="scoreAcceptable">0</div><div class="label">‚ö†Ô∏è Acceptables</div></div>
                    <div class="score-card red"><div class="num" id="scoreMauvaise">0</div><div class="label">‚ùå Reprises</div></div>
                </div>
                <div class="nclc-box"><div class="label">Estimation NCLC</div><div class="level" id="nclcLevel">7-8</div></div>
                <div class="tips-box"><h4>üí° Conseils</h4><ul id="tipsList"></ul></div>
                <div class="results-actions">
                    <button class="btn btn-secondary" onclick="App.restart()">Recommencer</button>
                    <button class="btn btn-primary" onclick="App.backToMenu()">Autre sc√©nario</button>
                </div>
            </div>
        </div>
    </div>

<script>
// ============================================================
// SCENARIO DATA - Each response leads naturally to next topic
// ============================================================
const SCENARIOS = [
    // ========== SCENARIO 1: LOUER UN APPARTEMENT ==========
    {
        icon: 'üè†',
        title: 'Louer un appartement',
        context: `Vous avez vu une annonce sur le site d'une agence immobili√®re pour un appartement de trois pi√®ces situ√© dans le quartier du Plateau-Mont-Royal √† Montr√©al. Le loyer affich√© est de 1 450 $ par mois. Vous t√©l√©phonez √† l'agence pour obtenir plus de renseignements avant de prendre rendez-vous pour une visite.`,
        objective: `<strong>Votre objectif :</strong> Poser des questions pr√©cises et professionnelles pour obtenir toutes les informations n√©cessaires sur l'appartement.`,
        opening: `Agence Immobili√®re Dumoulin, bonjour. Je suis Nathalie, comment puis-je vous aider ?`,
        rounds: [
            {
                // Round 1: User identifies the apartment
                options: [
                    { text: `C'est pour un appartement.`, type: 'mauvaise' },
                    { text: `Bonjour, j'appelle pour une annonce que j'ai vue.`, type: 'mauvaise' },
                    { text: `Bonjour, j'ai vu une annonce pour un appartement sur le Plateau. Il est encore disponible ?`, type: 'acceptable' },
                    { text: `Bonjour Madame. Je vous appelle au sujet de l'appartement de trois pi√®ces situ√© rue Saint-Denis, dans le Plateau-Mont-Royal. Pourriez-vous me confirmer s'il est toujours disponible ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Euh, oui... c'est √† quel sujet exactement ? Nous avons plusieurs annonces en ce moment.`,
                    acceptable: `Oui, le T3 sur le Plateau est toujours disponible. Il est √† 1 450 $ par mois. Vous avez des questions ?`,
                    ideale: `Ah oui, le trois-pi√®ces rue Saint-Denis ! Oui, il est toujours disponible, √† 1 450 $ par mois. Qu'aimeriez-vous savoir sur cet appartement ?`
                },
                feedback: {
                    mauvaise: `Votre phrase ne pr√©cise pas de quel appartement il s'agit. L'interlocuteur doit demander des clarifications. √Ä NCLC 8, soyez pr√©cis d√®s le d√©part.`,
                    acceptable: `Compr√©hensible, mais une formulation plus compl√®te (adresse, type) serait plus professionnelle.`,
                    ideale: `Excellent ! Vous avez identifi√© l'appartement avec des d√©tails pr√©cis. Conversation efficace d√®s le d√©part.`
                }
            },
            {
                // Round 2: User asks about rent/charges
                options: [
                    { text: `C'est cher ?`, type: 'mauvaise' },
                    { text: `Le loyer, c'est combien exactement ?`, type: 'mauvaise' },
                    { text: `Pourriez-vous me pr√©ciser si des charges sont incluses dans le loyer ?`, type: 'acceptable' },
                    { text: `Je voudrais savoir si le loyer de 1 450 $ inclut les charges, notamment le chauffage, l'eau chaude et l'√©lectricit√© ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Le loyer est de 1 450 $, comme indiqu√©. C'est un bon prix pour le quartier.`,
                    acceptable: `Les charges ne sont pas comprises. Il faut compter environ 80 $ de plus par mois pour l'√©lectricit√© et le chauffage.`,
                    ideale: `Le loyer de 1 450 $ inclut le chauffage et l'eau chaude. Seule l'√©lectricit√© est √† votre charge, environ 50 $ par mois car l'appartement est bien isol√©. Voulez-vous des d√©tails sur l'appartement lui-m√™me ?`
                },
                feedback: {
                    mauvaise: `¬´ C'est cher ? ¬ª est trop vague et informel. Le prix est dans l'annonce. Demandez plut√¥t des d√©tails sur les charges.`,
                    acceptable: `Bonne question sur les charges. Vous pourriez √™tre plus complet en mentionnant les diff√©rents types de charges.`,
                    ideale: `Parfait ! Vous avez anticip√© tous les d√©tails importants concernant les charges. C'est le niveau NCLC 8.`
                }
            },
            {
                // Round 3: User asks about size/layout
                options: [
                    { text: `C'est grand comment ?`, type: 'mauvaise' },
                    { text: `Il y a combien de pi√®ces exactement ?`, type: 'mauvaise' },
                    { text: `Quelle est la superficie de l'appartement ?`, type: 'acceptable' },
                    { text: `Pourriez-vous me donner la superficie totale et la r√©partition des pi√®ces ? √Ä quel √©tage se trouve l'appartement et y a-t-il un ascenseur ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `C'est un trois-pi√®ces, donc un salon et deux chambres. C'est assez spacieux.`,
                    acceptable: `L'appartement fait 78 m√®tres carr√©s. C'est au troisi√®me √©tage d'un immeuble de quatre √©tages.`,
                    ideale: `L'appartement fait 78 m√®tres carr√©s : un salon de 25 m¬≤, deux chambres de 12 et 14 m¬≤, une cuisine √©quip√©e et une salle de bain. C'est au troisi√®me √©tage avec ascenseur. Pour le dossier de location, avez-vous des questions sur les documents requis ?`
                },
                feedback: {
                    mauvaise: `Trop vague. Demandez la superficie exacte et des d√©tails pratiques comme l'√©tage.`,
                    acceptable: `Bonne question sur la superficie. Vous pourriez aussi demander l'√©tage et l'ascenseur en une seule question.`,
                    ideale: `Excellent ! Question compl√®te couvrant superficie, r√©partition et aspects pratiques.`
                }
            },
            {
                // Round 4: User asks about documents/conditions
                options: [
                    { text: `Il faut quoi comme papiers ?`, type: 'mauvaise' },
                    { text: `C'est quoi les conditions pour louer ?`, type: 'mauvaise' },
                    { text: `Quels documents dois-je fournir pour constituer mon dossier ?`, type: 'acceptable' },
                    { text: `Pourriez-vous me d√©tailler les pi√®ces justificatives n√©cessaires pour le dossier de candidature ? Y a-t-il des exigences particuli√®res concernant les revenus ou un garant ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Il faut les documents habituels : pi√®ce d'identit√©, fiches de paie... Vous connaissez.`,
                    acceptable: `Nous demandons une pi√®ce d'identit√©, vos trois derni√®res fiches de paie, et une lettre de r√©f√©rence de votre ancien propri√©taire. Le d√©p√¥t de garantie est d'un mois de loyer.`,
                    ideale: `Pour le dossier : pi√®ce d'identit√©, trois derni√®res fiches de paie, attestation d'emploi, et une r√©f√©rence de votre ancien propri√©taire. Nous demandons des revenus d'au moins trois fois le loyer. Le d√©p√¥t est d'un mois, encaiss√© √† la signature. Souhaitez-vous organiser une visite ?`
                },
                feedback: {
                    mauvaise: `Trop informel. Utilisez un registre soutenu et soyez plus pr√©cis dans votre demande.`,
                    acceptable: `Bonne question. Pensez √† demander aussi les conditions de revenus ou de garantie.`,
                    ideale: `Parfait ! Question compl√®te et professionnelle qui anticipe tous les aspects administratifs.`
                }
            },
            {
                // Round 5: User schedules a visit
                options: [
                    { text: `Je peux venir quand ?`, type: 'mauvaise' },
                    { text: `C'est possible de visiter bient√¥t ?`, type: 'mauvaise' },
                    { text: `Quelles sont vos disponibilit√©s pour une visite ?`, type: 'acceptable' },
                    { text: `Serait-il possible d'organiser une visite ? Je suis disponible jeudi apr√®s-midi ou samedi matin. Quel cr√©neau vous conviendrait le mieux ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `On peut organiser quelque chose. Vous √™tes disponible quand ?`,
                    acceptable: `Je peux vous proposer jeudi √† 14h ou 16h, ou samedi √† 10h. Qu'est-ce qui vous arrange ?`,
                    ideale: `Parfait ! Je vous propose samedi √† 10h, √ßa vous convient ? L'adresse est le 4521, rue Saint-Denis. La visite dure environ 20 minutes. Vous aurez besoin d'autre chose avant la visite ?`
                },
                feedback: {
                    mauvaise: `Trop direct et manque de politesse. Proposez vos propres disponibilit√©s.`,
                    acceptable: `Bonne d√©marche. Proposer vos cr√©neaux facilite l'organisation.`,
                    ideale: `Excellent ! Vous proposez des cr√©neaux pr√©cis tout en restant flexible. Tr√®s professionnel.`
                }
            },
            {
                // Round 6: User closes politely
                options: [
                    { text: `Non c'est bon.`, type: 'mauvaise' },
                    { text: `OK, √† samedi alors.`, type: 'mauvaise' },
                    { text: `Non merci, c'est parfait. √Ä samedi !`, type: 'acceptable' },
                    { text: `Non, je crois avoir toutes les informations n√©cessaires. Je vous remercie pour votre disponibilit√©, Nathalie. Je serai donc au 4521, rue Saint-Denis samedi √† 10h. Excellente journ√©e !`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord. Au revoir.`,
                    acceptable: `Tr√®s bien, √† samedi alors. Bonne journ√©e !`,
                    ideale: `Merci √† vous ! Je vous attends samedi √† 10h. N'h√©sitez pas √† rappeler si vous avez d'autres questions. Excellente journ√©e !`
                },
                feedback: {
                    mauvaise: `Trop bref et impoli. Confirmez les d√©tails et remerciez votre interlocuteur.`,
                    acceptable: `Correct, mais r√©capituler les informations montrerait votre professionnalisme.`,
                    ideale: `Parfait ! R√©capitulatif des informations, remerciements personnalis√©s et formule de politesse appropri√©e.`
                }
            }
        ]
    },

    // ========== SCENARIO 2: RETOURNER UN PRODUIT ==========
    {
        icon: 'üõçÔ∏è',
        title: 'Retourner un produit',
        context: `Vous avez achet√© un ordinateur portable en ligne il y a deux semaines. Depuis hier, l'√©cran affiche des lignes horizontales et l'appareil surchauffe anormalement. Vous contactez le service client pour signaler le probl√®me et demander un √©change ou un remboursement.`,
        objective: `<strong>Votre objectif :</strong> Expliquer clairement le probl√®me et obtenir une solution satisfaisante (√©change ou remboursement).`,
        opening: `TechnoPlus, service client, bonjour. Je suis Marc. Comment puis-je vous aider aujourd'hui ?`,
        rounds: [
            {
                options: [
                    { text: `Mon ordi marche plus.`, type: 'mauvaise' },
                    { text: `J'ai un probl√®me avec un achat.`, type: 'mauvaise' },
                    { text: `Bonjour, j'ai achet√© un ordinateur il y a deux semaines et il ne fonctionne plus correctement.`, type: 'acceptable' },
                    { text: `Bonjour Marc. Je vous contacte au sujet d'un ordinateur portable command√© il y a deux semaines. Depuis hier, l'√©cran pr√©sente des lignes horizontales et l'appareil surchauffe. J'aimerais proc√©der √† un √©change ou un remboursement.`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord... c'est quoi comme appareil exactement ? Vous pouvez me donner plus de d√©tails ?`,
                    acceptable: `Je vois. Quel type de probl√®me rencontrez-vous exactement ? Et avez-vous votre num√©ro de commande ?`,
                    ideale: `Je suis d√©sol√© pour ce d√©sagr√©ment. Laissez-moi acc√©der √† votre dossier. Pouvez-vous me d√©crire plus pr√©cis√©ment les sympt√¥mes que vous observez ?`
                },
                feedback: {
                    mauvaise: `Trop vague. Pr√©cisez le produit, le probl√®me et ce que vous souhaitez obtenir.`,
                    acceptable: `Vous avez identifi√© le produit et la p√©riode. Ajoutez le probl√®me pr√©cis et votre demande.`,
                    ideale: `Excellent ! Tous les √©l√©ments essentiels sont pr√©sents pour un traitement rapide.`
                }
            },
            {
                options: [
                    { text: `Ben, √ßa marche pas bien quoi.`, type: 'mauvaise' },
                    { text: `L'√©cran a des probl√®mes et il chauffe.`, type: 'mauvaise' },
                    { text: `L'√©cran affiche des lignes horizontales color√©es depuis hier, et l'ordinateur devient tr√®s chaud rapidement.`, type: 'acceptable' },
                    { text: `Depuis hier, des lignes horizontales vertes et roses apparaissent sur l'√©cran, surtout dans la partie inf√©rieure. De plus, l'appareil chauffe excessivement apr√®s dix minutes d'utilisation, le ventilateur tourne en permanence. Je n'ai install√© aucun nouveau logiciel.`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Des probl√®mes comment ? Il faudrait √™tre plus pr√©cis pour que je puisse vous aider.`,
                    acceptable: `D'accord, ces sympt√¥mes semblent indiquer un probl√®me mat√©riel. L'appareil est sous garantie. Que souhaitez-vous faire ?`,
                    ideale: `Ces sympt√¥mes indiquent clairement un d√©faut mat√©riel, probablement la carte graphique ou le syst√®me de refroidissement. Votre appareil est sous garantie. Je peux vous proposer un √©change standard ou un remboursement int√©gral. Quelle option pr√©f√©rez-vous ?`
                },
                feedback: {
                    mauvaise: `¬´ √áa marche pas ¬ª est trop vague. D√©crivez les sympt√¥mes pr√©cis√©ment.`,
                    acceptable: `Bonne description. Ajouter des d√©tails (couleurs, dur√©e, circonstances) aide au diagnostic.`,
                    ideale: `Parfait ! Description pr√©cise et chronologique qui facilite le diagnostic.`
                }
            },
            {
                options: [
                    { text: `Je sais pas, c'est quoi le mieux ?`, type: 'mauvaise' },
                    { text: `Je veux un √©change.`, type: 'mauvaise' },
                    { text: `Je pr√©f√©rerais un √©change. Comment se passe la proc√©dure de retour ?`, type: 'acceptable' },
                    { text: `Je pr√©f√©rerais un √©change. Pourriez-vous m'expliquer la proc√©dure exacte ? Notamment, combien de temps faudra-t-il pour recevoir le nouvel appareil et dois-je renvoyer l'ancien d'abord ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `C'est √† vous de d√©cider. √âchange ou remboursement ?`,
                    acceptable: `Pour l'√©change, nous vous envoyons le nouvel appareil sous 3 √† 5 jours apr√®s r√©ception du retour. Comment souhaitez-vous renvoyer l'appareil d√©fectueux ?`,
                    ideale: `Pour l'√©change, nous pouvons vous envoyer le nouvel appareil en express sous 48h, et vous aurez 14 jours pour nous retourner l'ancien. Les frais de retour sont √† notre charge. Pr√©f√©rez-vous d√©poser le colis en point relais ou un enl√®vement √† domicile ?`
                },
                feedback: {
                    mauvaise: `Exprimez clairement votre pr√©f√©rence et posez des questions sur la proc√©dure.`,
                    acceptable: `Bon choix avec question de suivi. Demandez aussi les d√©lais pr√©cis.`,
                    ideale: `Excellent ! Pr√©f√©rence claire et questions pratiques importantes sur les d√©lais.`
                }
            },
            {
                options: [
                    { text: `C'est o√π le point relais ?`, type: 'mauvaise' },
                    { text: `Comment je fais pour renvoyer ?`, type: 'mauvaise' },
                    { text: `Un enl√®vement √† domicile m'arrangerait. Quand serait-ce possible ?`, type: 'acceptable' },
                    { text: `Je pr√©f√©rerais un enl√®vement √† domicile. Quels cr√©neaux horaires proposez-vous et dois-je pr√©parer le colis d'une mani√®re particuli√®re ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Pour le point relais, je peux vous envoyer l'adresse. Ou vous pr√©f√©rez autre chose ?`,
                    acceptable: `Je peux programmer un enl√®vement demain. Le matin ou l'apr√®s-midi ?`,
                    ideale: `Parfait. Je peux programmer l'enl√®vement demain entre 9h et 12h ou entre 14h et 17h. Gardez l'emballage d'origine si possible, sinon n'importe quel carton solide convient. Je vous envoie une √©tiquette de retour par courriel. Voulez-vous une confirmation √©crite de tout cela ?`
                },
                feedback: {
                    mauvaise: `Question trop vague. Pr√©cisez vos pr√©f√©rences et posez des questions pratiques.`,
                    acceptable: `Bonne question. Demandez aussi comment pr√©parer le colis.`,
                    ideale: `Parfait ! Questions pratiques et pr√©cises sur la logistique.`
                }
            },
            {
                options: [
                    { text: `OK.`, type: 'mauvaise' },
                    { text: `Oui, envoyez-moi un courriel.`, type: 'mauvaise' },
                    { text: `Oui, une confirmation par courriel serait parfait. Merci.`, type: 'acceptable' },
                    { text: `Oui, je souhaiterais recevoir un r√©capitulatif par courriel avec le num√©ro de dossier, les d√©tails de l'enl√®vement et le suivi de l'√©change.`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord, je vous envoie √ßa. Autre chose ?`,
                    acceptable: `Je vous envoie la confirmation tout de suite avec les d√©tails. Avez-vous d'autres questions ?`,
                    ideale: `Je vous envoie imm√©diatement un courriel r√©capitulatif avec votre num√©ro de dossier, les d√©tails de l'enl√®vement programm√© demain matin, et un lien pour suivre l'exp√©dition de votre nouvel appareil. Y a-t-il autre chose que je puisse faire pour vous ?`
                },
                feedback: {
                    mauvaise: `Trop bref. Pr√©cisez ce que vous souhaitez recevoir.`,
                    acceptable: `Bien. Demander le num√©ro de dossier et le suivi serait encore mieux.`,
                    ideale: `Excellent ! Vous vous assurez d'avoir tous les √©l√©ments pour suivre votre dossier.`
                }
            },
            {
                options: [
                    { text: `Non, salut.`, type: 'mauvaise' },
                    { text: `Non, c'est bon. Merci.`, type: 'mauvaise' },
                    { text: `Non, je crois que tout est clair. Merci beaucoup pour votre aide. Bonne journ√©e !`, type: 'acceptable' },
                    { text: `Non, vous avez r√©pondu √† toutes mes questions. Je r√©capitule : enl√®vement demain matin, nouvel appareil sous 48h. Je vous remercie pour votre efficacit√© et votre professionnalisme, Marc. Excellente journ√©e !`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Au revoir.`,
                    acceptable: `De rien, bonne journ√©e et n'h√©sitez pas √† nous recontacter si besoin.`,
                    ideale: `Merci √† vous pour votre patience ! Tout sera r√©gl√© rapidement. N'h√©sitez pas √† nous recontacter via votre num√©ro de dossier si vous avez la moindre question. Excellente journ√©e !`
                },
                feedback: {
                    mauvaise: `Trop abrupt. Remerciez votre interlocuteur pour son aide.`,
                    acceptable: `Bonne conclusion. Un r√©capitulatif montrerait votre professionnalisme.`,
                    ideale: `Parfait ! Conclusion professionnelle avec r√©capitulatif et remerciements personnalis√©s.`
                }
            }
        ]
    },

    // ========== SCENARIO 3: OFFRE D'EMPLOI ==========
    {
        icon: 'üíº',
        title: "Se renseigner sur une offre d'emploi",
        context: `Vous avez vu une offre d'emploi pour un poste de charg√© de communication dans une entreprise de technologies environnementales, √âcoTech Solutions. L'annonce mentionne un CDI et ¬´ salaire selon exp√©rience ¬ª. Vous appelez pour obtenir plus de renseignements avant d'envoyer votre candidature.`,
        objective: `<strong>Votre objectif :</strong> Obtenir des informations pr√©cises sur le poste, les conditions et le processus de recrutement.`,
        opening: `√âcoTech Solutions, bonjour. Ressources humaines, Sophie √† l'appareil.`,
        rounds: [
            {
                options: [
                    { text: `C'est pour un emploi.`, type: 'mauvaise' },
                    { text: `Bonjour, vous avez encore des postes disponibles ?`, type: 'mauvaise' },
                    { text: `Bonjour, j'appelle pour le poste de charg√© de communication. Il est toujours ouvert ?`, type: 'acceptable' },
                    { text: `Bonjour Sophie. Je me permets de vous appeler au sujet de l'offre de charg√© de communication publi√©e sur votre site. J'aurais quelques questions avant de soumettre ma candidature. Le poste est-il toujours √† pourvoir ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Quel poste vous int√©resse exactement ? Nous avons plusieurs offres en ce moment.`,
                    acceptable: `Oui, le poste est encore ouvert. La date limite est dans deux semaines. Que voulez-vous savoir ?`,
                    ideale: `Bonjour ! Oui, le poste de charg√© de communication est toujours √† pourvoir. La date limite pour postuler est le 15 du mois prochain. Je vous √©coute, quelles sont vos questions ?`
                },
                feedback: {
                    mauvaise: `Trop vague. Identifiez clairement le poste et exprimez votre demande.`,
                    acceptable: `Poste identifi√©, mais une formulation plus professionnelle montrerait votre motivation.`,
                    ideale: `Excellent ! Demande professionnelle et structur√©e qui montre votre s√©rieux.`
                }
            },
            {
                options: [
                    { text: `Je ferais quoi exactement ?`, type: 'mauvaise' },
                    { text: `C'est quoi les missions ?`, type: 'mauvaise' },
                    { text: `Pourriez-vous me d√©tailler les missions principales du poste ?`, type: 'acceptable' },
                    { text: `Pourriez-vous me pr√©senter les missions principales ainsi que les projets concrets sur lesquels je serais amen√© √† travailler ? Y a-t-il des responsabilit√©s particuli√®res li√©es √† ce poste ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `C'est un poste de communication, donc vous ferez de la communication externe, des r√©seaux sociaux...`,
                    acceptable: `Les missions incluent la r√©daction de communiqu√©s de presse, la gestion des r√©seaux sociaux et l'organisation d'√©v√©nements. Vous travaillerez avec une √©quipe de cinq personnes.`,
                    ideale: `Le poste comprend la strat√©gie de communication digitale, la r√©daction de communiqu√©s, la gestion des r√©seaux sociaux et les relations presse. Vous organiserez aussi notre salon annuel de l'environnement. L'√©quipe compte cinq personnes et le poste est rattach√© √† la direction marketing. Avez-vous des questions sur le profil recherch√© ?`
                },
                feedback: {
                    mauvaise: `Trop informel. Demandez les missions de mani√®re professionnelle.`,
                    acceptable: `Bonne question. Demander aussi les projets sp√©cifiques montrerait votre int√©r√™t.`,
                    ideale: `Parfait ! Question compl√®te qui couvre missions, projets et responsabilit√©s.`
                }
            },
            {
                options: [
                    { text: `Il faut quoi comme dipl√¥me ?`, type: 'mauvaise' },
                    { text: `C'est quoi le profil recherch√© ?`, type: 'mauvaise' },
                    { text: `Quelles sont les comp√©tences techniques attendues pour ce poste ?`, type: 'acceptable' },
                    { text: `En dehors de l'exp√©rience en communication, y a-t-il des comp√©tences techniques sp√©cifiques attendues ? Je pense notamment aux outils num√©riques, aux langues √©trang√®res ou √† des certifications particuli√®res.`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `On cherche quelqu'un avec de l'exp√©rience en communication. Trois ans minimum.`,
                    acceptable: `Nous demandons trois ans d'exp√©rience, une excellente ma√Ætrise du fran√ßais √©crit, et la capacit√© de g√©rer plusieurs projets. La suite Adobe serait un plus.`,
                    ideale: `Nous recherchons trois ans d'exp√©rience en communication, une excellente ma√Ætrise du fran√ßais √©crit, et des comp√©tences en gestion de projet. La suite Adobe et les outils SEO sont appr√©ci√©s. L'anglais professionnel est un atout pour nos partenaires internationaux. Voulez-vous conna√Ætre les conditions du poste ?`
                },
                feedback: {
                    mauvaise: `Question trop basique. Ciblez les comp√©tences techniques ou linguistiques.`,
                    acceptable: `Bonne question. Mentionner des domaines sp√©cifiques montre votre pr√©paration.`,
                    ideale: `Excellent ! Question strat√©gique qui vous permet de mettre en valeur vos comp√©tences.`
                }
            },
            {
                options: [
                    { text: `C'est pay√© combien ?`, type: 'mauvaise' },
                    { text: `Et le salaire ?`, type: 'mauvaise' },
                    { text: `Pourriez-vous me pr√©ciser la fourchette salariale et les avantages sociaux ?`, type: 'acceptable' },
                    { text: `Je vous remercie pour ces informations. Pourriez-vous me d√©tailler les conditions du poste : fourchette salariale, avantages sociaux, et possibilit√©s de t√©l√©travail ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Le salaire d√©pend de l'exp√©rience. C'est indiqu√© dans l'annonce.`,
                    acceptable: `La fourchette est entre 45 000 et 55 000 $ selon l'exp√©rience. Nous offrons une assurance collective et trois semaines de vacances.`,
                    ideale: `Le salaire est entre 45 000 et 55 000 $ selon l'exp√©rience. Les avantages incluent une assurance compl√®te sant√© et dentaire, un r√©gime de retraite avec contribution employeur, quatre semaines de vacances, et deux jours de t√©l√©travail par semaine. Avez-vous des questions sur le processus de recrutement ?`
                },
                feedback: {
                    mauvaise: `Trop direct et informel. Demandez les conditions de mani√®re professionnelle.`,
                    acceptable: `Bonne question. Inclure le t√©l√©travail et autres avantages serait plus complet.`,
                    ideale: `Parfait ! Question compl√®te qui couvre tous les aspects des conditions de travail.`
                }
            },
            {
                options: [
                    { text: `C'est quand les entretiens ?`, type: 'mauvaise' },
                    { text: `Comment √ßa se passe pour postuler ?`, type: 'mauvaise' },
                    { text: `Quel est le calendrier pr√©vu pour le processus de recrutement ?`, type: 'acceptable' },
                    { text: `Pourriez-vous me pr√©ciser les √©tapes du processus de recrutement, le calendrier pr√©vu, et la date d'entr√©e en poste envisag√©e ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Envoyez votre CV et on vous recontactera si √ßa correspond.`,
                    acceptable: `Le processus comprend une s√©lection sur CV, puis un entretien avec le responsable marketing et un avec la DRH. Comptez deux √† trois semaines.`,
                    ideale: `Le processus se d√©roule en trois √©tapes : s√©lection sur CV sous huit jours, premier entretien en visioconf√©rence de 45 minutes avec le responsable marketing, puis entretien en pr√©sentiel avec mise en situation et rencontre avec la DRH. La prise de poste est pr√©vue en f√©vrier. Avez-vous d'autres questions ?`
                },
                feedback: {
                    mauvaise: `Trop vague. Demandez les √©tapes pr√©cises et le calendrier.`,
                    acceptable: `Bonne question sur le calendrier. Demander la date de d√©but enrichirait votre question.`,
                    ideale: `Excellent ! Question compl√®te qui vous permet de bien planifier votre candidature.`
                }
            },
            {
                options: [
                    { text: `OK, au revoir.`, type: 'mauvaise' },
                    { text: `D'accord, j'envoie mon CV. Merci.`, type: 'mauvaise' },
                    { text: `Non, merci beaucoup pour ces informations. Je vous envoie ma candidature tr√®s prochainement. Bonne journ√©e !`, type: 'acceptable' },
                    { text: `Non, vous avez r√©pondu √† toutes mes questions. Ce poste correspond parfaitement √† mon profil et √† mes attentes. Je vous envoie mon dossier complet dans les prochains jours √† l'adresse indiqu√©e. Je vous remercie pour votre disponibilit√©, Sophie. Excellente journ√©e !`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Au revoir.`,
                    acceptable: `Tr√®s bien, nous attendons votre candidature. Bonne journ√©e !`,
                    ideale: `Merci pour votre int√©r√™t ! Nous serons ravis de recevoir votre candidature. L'adresse est recrutement@ecotech.ca. N'h√©sitez pas √† rappeler si vous avez d'autres questions. Excellente journ√©e et √† bient√¥t j'esp√®re !`
                },
                feedback: {
                    mauvaise: `Trop abrupt. Exprimez votre int√©r√™t et remerciez votre interlocuteur.`,
                    acceptable: `Bonne conclusion. Montrer votre enthousiasme renforcerait l'impression positive.`,
                    ideale: `Parfait ! Conclusion professionnelle qui exprime votre motivation et laisse une excellente impression.`
                }
            }
        ]
    },

    // ========== SCENARIO 4: MODIFIER UNE R√âSERVATION ==========
    {
        icon: 'üè®',
        title: 'Modifier une r√©servation',
        context: `Vous avez r√©serv√© une chambre d'h√¥tel √† Qu√©bec pour un voyage d'affaires, du 15 au 17 mars. Suite √† un changement dans votre emploi du temps, vous devez modifier les dates de votre s√©jour. Vous appelez l'h√¥tel Le Ch√¢teau Frontenac pour modifier votre r√©servation.`,
        objective: `<strong>Votre objectif :</strong> Modifier vos dates de r√©servation, v√©rifier les disponibilit√©s et vous assurer qu'il n'y a pas de frais suppl√©mentaires.`,
        opening: `H√¥tel Le Ch√¢teau Frontenac, service des r√©servations. Bonsoir, Philippe √† votre service.`,
        rounds: [
            {
                options: [
                    { text: `Je veux changer ma r√©servation.`, type: 'mauvaise' },
                    { text: `Bonsoir, j'ai r√©serv√© une chambre et je dois modifier.`, type: 'mauvaise' },
                    { text: `Bonsoir, j'ai une r√©servation pour les 15 et 16 mars et j'aimerais modifier les dates.`, type: 'acceptable' },
                    { text: `Bonsoir Philippe. J'ai une r√©servation au nom de Tremblay pour les nuits du 15 et 16 mars. Suite √† un impr√©vu professionnel, j'aurais besoin de d√©caler les dates de mon s√©jour. Serait-ce possible ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Bonsoir. √Ä quel nom est la r√©servation et pour quelles dates ?`,
                    acceptable: `Bonsoir. Je retrouve votre r√©servation. C'est bien une chambre Sup√©rieure ? Quelles seraient les nouvelles dates souhait√©es ?`,
                    ideale: `Bonsoir Monsieur Tremblay. Je vois votre r√©servation : une chambre Sup√©rieure pour les nuits du 15 et 16 mars. Bien s√ªr, nous pouvons √©tudier un changement de dates. Quelles seraient vos nouvelles dates ?`
                },
                feedback: {
                    mauvaise: `Trop direct. Donnez votre nom et les d√©tails de la r√©servation.`,
                    acceptable: `Dates mentionn√©es, mais fournir votre nom faciliterait la recherche.`,
                    ideale: `Excellent ! Tous les √©l√©ments n√©cessaires pour identifier rapidement votre r√©servation.`
                }
            },
            {
                options: [
                    { text: `Plus tard dans le mois, c'est possible ?`, type: 'mauvaise' },
                    { text: `La semaine d'apr√®s, vous avez de la place ?`, type: 'mauvaise' },
                    { text: `J'aimerais d√©caler au 22 et 23 mars. Avez-vous des disponibilit√©s ?`, type: 'acceptable' },
                    { text: `J'aurais besoin de reporter mon s√©jour aux nuits du 22 et 23 mars. Auriez-vous des disponibilit√©s pour ces dates, id√©alement pour le m√™me type de chambre ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Plus tard quand exactement ? J'ai besoin de dates pr√©cises pour v√©rifier.`,
                    acceptable: `Laissez-moi v√©rifier... Oui, nous avons de la disponibilit√© pour les 22 et 23 mars. Par contre, le tarif est l√©g√®rement diff√©rent.`,
                    ideale: `Je v√©rifie imm√©diatement... Oui, nous avons une chambre Sup√©rieure disponible pour les nuits du 22 et 23 mars. Je dois vous informer que le tarif est de 285 $ par nuit au lieu de 265 $, car il y a le Festival de musique de Qu√©bec ce week-end-l√†. Cela vous convient-il ?`
                },
                feedback: {
                    mauvaise: `¬´ Plus tard ¬ª est trop vague. Donnez des dates pr√©cises.`,
                    acceptable: `Bonne pr√©cision des dates. Demander le m√™me type de chambre serait plus complet.`,
                    ideale: `Parfait ! Dates pr√©cises et demande explicite pour le m√™me type de chambre.`
                }
            },
            {
                options: [
                    { text: `C'est cher ! Pourquoi √ßa augmente ?`, type: 'mauvaise' },
                    { text: `20 $ de plus ? Vous n'avez pas mieux ?`, type: 'mauvaise' },
                    { text: `Je comprends pour la diff√©rence de tarif. C'est d'accord pour moi.`, type: 'acceptable' },
                    { text: `Je comprends pour le festival. Y aurait-il un geste commercial possible pour compenser cette diff√©rence, comme le petit-d√©jeuner inclus ou un surclassement ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `C'est le tarif en p√©riode de festival. C'est la m√™me chose partout en ville.`,
                    acceptable: `Tr√®s bien. Je modifie donc votre r√©servation. Concernant le paiement, souhaitez-vous r√©gler maintenant ou √† l'arriv√©e ?`,
                    ideale: `Je peux tout √† fait vous offrir le petit-d√©jeuner continental pour les deux matins, ce qui repr√©sente une valeur de 80 $. Cela compenserait largement la diff√©rence de tarif. Est-ce que cela vous conviendrait ?`
                },
                feedback: {
                    mauvaise: `√âvitez les commentaires n√©gatifs. Demandez plut√¥t des alternatives ou avantages.`,
                    acceptable: `Acceptation correcte, mais n√©gocier un avantage serait plus strat√©gique.`,
                    ideale: `Excellent ! N√©gociation professionnelle et courtoise pour obtenir une compensation.`
                }
            },
            {
                options: [
                    { text: `OK, √ßa va.`, type: 'mauvaise' },
                    { text: `Oui, d'accord pour le petit-d√©jeuner.`, type: 'mauvaise' },
                    { text: `Oui, c'est parfait. Merci beaucoup. Le petit-d√©jeuner est servi √† quelle heure ?`, type: 'acceptable' },
                    { text: `C'est une excellente proposition, j'accepte avec plaisir. Pourriez-vous me pr√©ciser les horaires du petit-d√©jeuner et serait-il possible de demander une chambre en √©tage √©lev√© avec vue ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Tr√®s bien. Autre chose ?`,
                    acceptable: `Le petit-d√©jeuner est servi de 7h √† 10h au restaurant Le Champlain. Avez-vous d'autres demandes ?`,
                    ideale: `Parfait ! Je note votre pr√©f√©rence pour un √©tage √©lev√© avec vue. Le petit-d√©jeuner est servi de 6h30 √† 10h30 au restaurant Le Champlain. Pour le paiement, pr√©f√©rez-vous r√©gler maintenant ou √† votre arriv√©e ?`
                },
                feedback: {
                    mauvaise: `Trop bref. Posez des questions pratiques sur le service offert.`,
                    acceptable: `Bonne question sur les horaires. Ajouter une pr√©f√©rence de chambre serait judicieux.`,
                    ideale: `Parfait ! Vous profitez de l'occasion pour demander des d√©tails et exprimer vos pr√©f√©rences.`
                }
            },
            {
                options: [
                    { text: `√Ä l'arriv√©e.`, type: 'mauvaise' },
                    { text: `Je paye comment ?`, type: 'mauvaise' },
                    { text: `Je pr√©f√©rerais r√©gler √† l'arriv√©e. Une garantie par carte est-elle n√©cessaire ?`, type: 'acceptable' },
                    { text: `Je souhaiterais r√©gler √† l'arriv√©e si possible. Une empreinte de carte bancaire est-elle requise pour garantir la r√©servation ? Et quels modes de paiement acceptez-vous ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `D'accord. Je note paiement √† l'arriv√©e. C'est tout ?`,
                    acceptable: `Oui, une empreinte de carte sera prise pour garantir la r√©servation. Le paiement se fera au d√©part. Autre chose ?`,
                    ideale: `Bien s√ªr. Une empreinte de carte sera prise pour garantir la r√©servation, mais le pr√©l√®vement ne sera effectu√© qu'√† votre d√©part. Nous acceptons toutes les cartes bancaires et les paiements par d√©bit. Votre r√©servation est maintenant modifi√©e. Puis-je faire autre chose pour vous ?`
                },
                feedback: {
                    mauvaise: `R√©ponse trop directe. Demandez les modalit√©s de paiement et de garantie.`,
                    acceptable: `Bonne question sur la garantie. Demander les modes de paiement serait plus complet.`,
                    ideale: `Excellent ! Vous clarifiez toutes les modalit√©s financi√®res.`
                }
            },
            {
                options: [
                    { text: `Non merci, au revoir.`, type: 'mauvaise' },
                    { text: `Non, c'est tout. Merci.`, type: 'mauvaise' },
                    { text: `Non, tout est parfait. Merci beaucoup pour votre aide. Bonne soir√©e !`, type: 'acceptable' },
                    { text: `Non, je crois que tout est en ordre. Je r√©capitule : chambre Sup√©rieure les 22 et 23 mars, petit-d√©jeuner inclus, pr√©f√©rence pour un √©tage √©lev√© avec vue, paiement √† l'arriv√©e. Je vous remercie pour votre flexibilit√© et votre professionnalisme, Philippe. Excellente soir√©e !`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Au revoir, bonne soir√©e.`,
                    acceptable: `De rien. Nous avons h√¢te de vous accueillir. Bonne soir√©e !`,
                    ideale: `C'est exactement cela ! Tout est bien not√©. Nous avons h√¢te de vous accueillir au Ch√¢teau Frontenac. Merci de votre confiance et excellente soir√©e, Monsieur Tremblay !`
                },
                feedback: {
                    mauvaise: `Trop bref. R√©capitulez les modifications et remerciez.`,
                    acceptable: `Bonne conclusion. Un r√©capitulatif montrerait votre attention aux d√©tails.`,
                    ideale: `Parfait ! R√©capitulatif complet et remerciements personnalis√©s. Tr√®s professionnel.`
                }
            }
        ]
    },

    // ========== SCENARIO 5: S'INSCRIRE √Ä UN COURS ==========
    {
        icon: 'üéæ',
        title: "S'inscrire √† un cours",
        context: `Vous souhaitez reprendre une activit√© sportive et vous avez entendu parler des cours de tennis propos√©s par le Centre sportif du Parc. Vous t√©l√©phonez pour obtenir des informations sur les cours pour adultes d√©butants et les modalit√©s d'inscription.`,
        objective: `<strong>Votre objectif :</strong> Obtenir des informations sur les cours disponibles (horaires, tarifs, niveaux) et comprendre la proc√©dure d'inscription.`,
        opening: `Centre sportif du Parc, bonjour. √âmilie √† l'accueil, comment puis-je vous aider ?`,
        rounds: [
            {
                options: [
                    { text: `Vous avez des cours de sport ?`, type: 'mauvaise' },
                    { text: `C'est pour des cours de tennis.`, type: 'mauvaise' },
                    { text: `Bonjour, j'aimerais me renseigner sur vos cours de tennis pour adultes.`, type: 'acceptable' },
                    { text: `Bonjour √âmilie. Je souhaiterais me renseigner sur vos cours de tennis pour adultes d√©butants. Pourriez-vous me pr√©senter les diff√©rentes formules que vous proposez ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Oui, nous avons beaucoup de cours. Qu'est-ce qui vous int√©resse exactement ?`,
                    acceptable: `Oui, nous avons des cours pour tous les niveaux. Vous √™tes plut√¥t d√©butant, interm√©diaire ou avanc√© ?`,
                    ideale: `Bonjour ! Nous avons plusieurs formules pour les adultes d√©butants : des cours collectifs en petits groupes et des le√ßons particuli√®res. Les cours collectifs sont limit√©s √† six personnes pour un bon suivi. Souhaitez-vous conna√Ætre les horaires disponibles ?`
                },
                feedback: {
                    mauvaise: `Trop vague. Pr√©cisez l'activit√© et votre niveau pour obtenir des informations pertinentes.`,
                    acceptable: `Bonne introduction. Pr√©ciser votre niveau et demander les formules serait plus efficace.`,
                    ideale: `Excellent ! Demande claire avec niveau et demande de pr√©sentation des options.`
                }
            },
            {
                options: [
                    { text: `C'est quand les cours ?`, type: 'mauvaise' },
                    { text: `Quels sont les horaires ?`, type: 'mauvaise' },
                    { text: `Quels cr√©neaux proposez-vous pour les cours collectifs d√©butants ?`, type: 'acceptable' },
                    { text: `Oui, j'aimerais conna√Ætre les cr√©neaux disponibles pour les cours collectifs. Combien de s√©ances comprend une session et quand commence la prochaine ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `On a des cours le soir et le week-end. √áa d√©pend du niveau.`,
                    acceptable: `Pour les d√©butants, nous avons le mardi soir de 19h √† 20h30 et le samedi matin de 10h √† 11h30. Chaque session comprend dix cours.`,
                    ideale: `Pour les cours collectifs d√©butants, nous proposons le mardi soir de 19h √† 20h30 ou le samedi matin de 10h √† 11h30. Les sessions comprennent dix cours et la prochaine d√©bute le 8 janvier pour se terminer le 15 mars. Il reste des places sur les deux cr√©neaux. Voulez-vous conna√Ætre les tarifs ?`
                },
                feedback: {
                    mauvaise: `Question trop vague. Pr√©cisez le type de cours et demandez la structure des sessions.`,
                    acceptable: `Bonne question sur les horaires. Demander aussi la dur√©e des sessions serait plus complet.`,
                    ideale: `Parfait ! Question compl√®te couvrant horaires, dur√©e et dates de session.`
                }
            },
            {
                options: [
                    { text: `C'est combien ?`, type: 'mauvaise' },
                    { text: `Et le prix ?`, type: 'mauvaise' },
                    { text: `Quel est le tarif pour une session de dix cours ?`, type: 'acceptable' },
                    { text: `Oui, pourriez-vous me pr√©ciser le tarif de la session ? Y a-t-il des r√©ductions possibles ou des facilit√©s de paiement ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `La session co√ªte 180 $. C'est le tarif standard.`,
                    acceptable: `La session de dix cours collectifs est √† 180 $. Cela inclut l'acc√®s aux courts et le pr√™t de raquettes pour les d√©butants.`,
                    ideale: `La session de dix cours est √† 180 $, incluant l'acc√®s aux courts et le pr√™t de raquettes. Nous proposons un tarif r√©duit de 150 $ pour les √©tudiants et les a√Æn√©s, ainsi qu'un tarif famille de 320 $ pour deux personnes. Le paiement peut √™tre √©chelonn√© en trois fois sans frais. Avez-vous des questions sur l'√©quipement n√©cessaire ?`
                },
                feedback: {
                    mauvaise: `Question trop directe. Demandez aussi ce qui est inclus et les r√©ductions possibles.`,
                    acceptable: `Bonne question. Demander les r√©ductions ou facilit√©s de paiement serait strat√©gique.`,
                    ideale: `Excellent ! Vous demandez le tarif et anticipez les options de r√©duction.`
                }
            },
            {
                options: [
                    { text: `Il faut acheter une raquette ?`, type: 'mauvaise' },
                    { text: `Je mets quoi comme v√™tements ?`, type: 'mauvaise' },
                    { text: `Quelle tenue recommandez-vous pour les cours ?`, type: 'acceptable' },
                    { text: `Pourriez-vous me pr√©ciser les exigences vestimentaires, notamment pour les chaussures ? Et avez-vous des recommandations pour le choix d'une raquette pour d√©butant ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Des v√™tements de sport normaux. Et des chaussures propres pour les courts.`,
                    acceptable: `Une tenue de sport confortable suffit. Pour les chaussures, nous demandons des semelles non marquantes. Nous pr√™tons les raquettes au d√©but.`,
                    ideale: `Portez une tenue de sport confortable. Pour les chaussures, les semelles claires sont obligatoires sur nos courts int√©rieurs ‚Äî notre boutique propose des mod√®les √† partir de 60 $ si n√©cessaire. Nous pr√™tons les raquettes pendant les premiers cours, et votre professeur pourra ensuite vous conseiller sur l'achat d'une raquette adapt√©e √† votre style. Souhaitez-vous conna√Ætre la proc√©dure d'inscription ?`
                },
                feedback: {
                    mauvaise: `Questions trop basiques s√©par√©es. Combinez vos demandes de fa√ßon structur√©e.`,
                    acceptable: `Bonne question. Demander aussi des conseils pour l'√©quipement serait utile.`,
                    ideale: `Parfait ! Question compl√®te couvrant tenue, chaussures et √©quipement.`
                }
            },
            {
                options: [
                    { text: `Comment on s'inscrit ?`, type: 'mauvaise' },
                    { text: `Je fais quoi pour m'inscrire ?`, type: 'mauvaise' },
                    { text: `Quelle est la proc√©dure d'inscription ?`, type: 'acceptable' },
                    { text: `Oui, pourriez-vous m'expliquer la proc√©dure d'inscription ? Est-il possible de s'inscrire en ligne et quels documents ou informations sont n√©cessaires ?`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Vous pouvez vous inscrire sur notre site ou passer √† l'accueil.`,
                    acceptable: `L'inscription se fait en ligne sur notre site ou directement √† l'accueil. Nous avons besoin d'une pi√®ce d'identit√© et du paiement.`,
                    ideale: `L'inscription est simple : cr√©ez un compte sur centresportifduparc.ca, s√©lectionnez le cr√©neau souhait√© et proc√©dez au paiement. Vous recevrez imm√©diatement une confirmation par courriel avec le lieu exact, le nom de votre professeur et la liste du mat√©riel recommand√©. Si vous pr√©f√©rez vous inscrire sur place, nous sommes ouverts du lundi au samedi de 9h √† 20h. Avez-vous d'autres questions ?`
                },
                feedback: {
                    mauvaise: `Question trop informelle. Demandez les d√©tails de la proc√©dure et les documents requis.`,
                    acceptable: `Bonne question. Demander les modalit√©s en ligne et les documents serait plus complet.`,
                    ideale: `Excellent ! Question compl√®te sur la proc√©dure et les documents n√©cessaires.`
                }
            },
            {
                options: [
                    { text: `Non, √ßa va. Merci, salut.`, type: 'mauvaise' },
                    { text: `Non, c'est bon. Au revoir.`, type: 'mauvaise' },
                    { text: `Non, c'est parfait. Merci pour ces informations, je vais m'inscrire. Bonne journ√©e !`, type: 'acceptable' },
                    { text: `Non, je crois avoir toutes les informations. Je r√©capitule : session de dix cours le samedi matin √† partir du 8 janvier, pour 180 $. Je m'inscris d√®s aujourd'hui sur centresportifduparc.ca. Merci beaucoup pour ces explications d√©taill√©es, √âmilie. J'ai h√¢te de commencer !`, type: 'ideale' },
                ],
                responses: {
                    mauvaise: `Au revoir.`,
                    acceptable: `Tr√®s bien, bonne inscription ! √Ä bient√¥t au centre.`,
                    ideale: `Parfait, c'est exactement √ßa ! Nous sommes ravis de vous accueillir bient√¥t sur les courts. N'h√©sitez pas √† rappeler si vous avez la moindre question. Excellente journ√©e et √† tr√®s bient√¥t !`
                },
                feedback: {
                    mauvaise: `Trop bref et impoli. R√©capitulez et remerciez votre interlocuteur.`,
                    acceptable: `Bonne conclusion. Un r√©capitulatif montrerait votre s√©rieux.`,
                    ideale: `Parfait ! R√©capitulatif complet, remerciements personnalis√©s et enthousiasme appropri√©.`
                }
            }
        ]
    }
];

// ============================================================
// APPLICATION
// ============================================================
const App = {
    voiceEnabled: false,
    apiKey: null,
    scenario: null,
    round: 0,
    selected: null,
    selectedText: null,
    lastType: null,
    lastResponse: null,
    lastQuestion: null,
    scores: { ideale: 0, acceptable: 0, mauvaise: 0 },
    textHidden: false,

    init() {
        this.renderScenarioList();
        const savedKey = sessionStorage.getItem('xi_key');
        if (savedKey) {
            document.getElementById('apiKey').value = savedKey;
            this.apiKey = savedKey;
            this.voiceEnabled = true;
            document.getElementById('apiStatus').textContent = 'üîä Voix activ√©e';
            document.getElementById('apiStatus').classList.add('active');
        }
    },

    renderScenarioList() {
        const container = document.getElementById('scenarioList');
        container.innerHTML = SCENARIOS.map((s, i) => `
            <div class="scenario-card" onclick="App.selectScenario(${i})">
                <div class="scenario-icon">${s.icon}</div>
                <div class="scenario-info">
                    <h3>${s.title}</h3>
                    <p>${s.context.substring(0, 100)}...</p>
                </div>
            </div>
        `).join('');
    },

    // Voice
    async activateVoice() {
        const key = document.getElementById('apiKey').value.trim();
        if (!key) return alert('Entrez une cl√© API.');
        try {
            const res = await fetch('https://api.elevenlabs.io/v1/user', { headers: { 'xi-api-key': key } });
            if (res.ok) {
                this.apiKey = key;
                this.voiceEnabled = true;
                sessionStorage.setItem('xi_key', key);
                document.getElementById('apiStatus').textContent = 'üîä Voix activ√©e';
                document.getElementById('apiStatus').classList.add('active');
            } else {
                alert('Cl√© invalide.');
            }
        } catch (e) { alert('Erreur de connexion.'); }
    },

    async speak(text) {
        if (!this.voiceEnabled || !this.apiKey) return;
        try {
            const res = await fetch('https://api.elevenlabs.io/v1/text-to-speech/XTyroWkQl32ZSd3rRVZ1', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'xi-api-key': this.apiKey },
                body: JSON.stringify({ text, model_id: 'eleven_multilingual_v2', voice_settings: { stability: 0.5, similarity_boost: 0.75 } })
            });
            if (res.ok) {
                const blob = await res.blob();
                new Audio(URL.createObjectURL(blob)).play();
            }
        } catch (e) { console.log('Audio error:', e); }
    },

    playCurrentAudio() {
        const text = this.round === 0 ? this.scenario.opening : this.lastResponse;
        if (text) this.speak(text);
    },

    toggleText() {
        this.textHidden = !this.textHidden;
        const textEl = document.getElementById('interviewerText');
        const btn = document.getElementById('toggleTextBtn');
        
        if (this.textHidden) {
            textEl.classList.add('hidden');
            btn.textContent = 'üëÅÔ∏è Afficher le texte';
        } else {
            textEl.classList.remove('hidden');
            btn.textContent = 'üëÅÔ∏è Masquer le texte';
        }
    },

    // Navigation
    showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    },

    selectScenario(index) {
        this.scenario = SCENARIOS[index];
        this.round = 0;
        this.scores = { ideale: 0, acceptable: 0, mauvaise: 0 };
        this.selected = null;
        this.selectedText = null;
        this.lastType = null;
        this.lastResponse = null;
        this.lastQuestion = null;

        document.getElementById('ctxTitle').innerHTML = `${this.scenario.icon} ${this.scenario.title}`;
        document.getElementById('ctxText').textContent = this.scenario.context;
        document.getElementById('ctxObjective').innerHTML = this.scenario.objective;
        this.showScreen('screenContext');
    },

    startDialogue() {
        this.showScreen('screenDialogue');
        this.renderRound();
    },

    backToMenu() { this.showScreen('screenSelect'); },

    restart() {
        this.round = 0;
        this.scores = { ideale: 0, acceptable: 0, mauvaise: 0 };
        this.selected = null;
        this.selectedText = null;
        this.lastType = null;
        this.lastResponse = null;
        this.lastQuestion = null;
        this.showScreen('screenDialogue');
        this.renderRound();
    },

    // Dialogue
    renderRound() {
        this.selected = null;
        this.lastType = null;

        const total = this.scenario.rounds.length;
        document.getElementById('progressBar').innerHTML =
            this.scenario.rounds.map((_, i) =>
                `<div class="progress-step ${i < this.round ? 'done' : ''} ${i === this.round ? 'current' : ''}"></div>`
            ).join('') + `<span class="progress-text">${this.round + 1}/${total}</span>`;

        // Show user's previous question (rounds 1+)
        const userBox = document.getElementById('userBox');
        if (this.round > 0 && this.lastQuestion) {
            document.getElementById('userText').textContent = `¬´ ${this.lastQuestion} ¬ª`;
            userBox.style.display = 'block';
        } else {
            userBox.style.display = 'none';
        }

        // Show either opening (round 0) or last response (rounds 1+)
        const displayText = this.round === 0 ? this.scenario.opening : this.lastResponse;
        const textEl = document.getElementById('interviewerText');
        textEl.textContent = `¬´ ${displayText} ¬ª`;
        
        // Apply text visibility state
        const toggleBtn = document.getElementById('toggleTextBtn');
        if (this.textHidden) {
            textEl.classList.add('hidden');
            toggleBtn.textContent = 'üëÅÔ∏è Afficher le texte';
        } else {
            textEl.classList.remove('hidden');
            toggleBtn.textContent = 'üëÅÔ∏è Masquer le texte';
        }

        // Shuffle options
        const r = this.scenario.rounds[this.round];
        const shuffled = [...r.options].sort(() => Math.random() - 0.5);
        document.getElementById('questionList').innerHTML = shuffled.map((opt, i) => `
            <div class="question-item" data-type="${opt.type}" onclick="App.selectOption(this)">
                <div class="question-radio"></div>
                <div class="question-content">¬´ ${opt.text} ¬ª</div>
            </div>
        `).join('');

        document.getElementById('btnValidate').disabled = true;
        document.getElementById('feedbackBox').classList.remove('visible', 'mauvaise', 'acceptable', 'ideale');
        document.getElementById('questionsSection').style.display = 'block';
        document.getElementById('validateRow').style.display = 'flex';

        if (this.voiceEnabled) setTimeout(() => this.playCurrentAudio(), 400);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    },

    selectOption(el) {
        document.querySelectorAll('.question-item').forEach(q => q.classList.remove('selected'));
        el.classList.add('selected');
        this.selected = el.dataset.type;
        this.selectedText = el.querySelector('.question-content').textContent.replace(/[¬´¬ª]/g, '').trim();
        document.getElementById('btnValidate').disabled = false;
    },

    validate() {
        if (!this.selected) return;

        const type = this.selected;
        this.lastType = type;
        this.scores[type]++;

        const r = this.scenario.rounds[this.round];
        const response = r.responses[type];
        const feedback = r.feedback[type];

        // Store question and response for next round (only if not mauvaise)
        if (type !== 'mauvaise') {
            this.lastQuestion = this.selectedText;
            this.lastResponse = response;
        }

        const icons = { mauvaise: '‚ùå', acceptable: '‚ö†Ô∏è', ideale: '‚úÖ' };
        const titles = { mauvaise: 'Question inappropri√©e', acceptable: 'Correct, mais basique', ideale: 'Excellent !' };
        document.getElementById('feedbackHeader').innerHTML = `${icons[type]} ${titles[type]}`;
        
        // For mauvaise, show the awkward response so user understands the consequence
        if (type === 'mauvaise') {
            document.getElementById('feedbackContent').innerHTML = `
                <p style="margin-bottom: 1rem;"><strong>L'interlocuteur r√©pond :</strong></p>
                <p style="font-style: italic; margin-bottom: 1rem;">¬´ ${response} ¬ª</p>
                <p>${feedback}</p>
            `;
        } else {
            document.getElementById('feedbackContent').innerHTML = `<p>${feedback}</p>`;
        }

        const btn = document.getElementById('btnContinue');
        if (type === 'mauvaise') {
            btn.textContent = 'Essayer encore ‚Üí';
        } else if (this.round < this.scenario.rounds.length - 1) {
            btn.textContent = 'Continuer ‚Üí';
        } else {
            btn.textContent = 'Voir les r√©sultats ‚Üí';
        }

        document.getElementById('feedbackBox').className = `feedback-box visible ${type}`;
        document.getElementById('questionsSection').style.display = 'none';
        document.getElementById('validateRow').style.display = 'none';
    },

    continue() {
        if (this.lastType === 'mauvaise') {
            this.renderRound(); // Retry same round, keep lastResponse from before
        } else if (this.round < this.scenario.rounds.length - 1) {
            this.round++;
            this.renderRound(); // lastResponse is already set to the interviewer's response
        } else {
            this.showResults();
        }
    },

    showResults() {
        document.getElementById('resultsTitle').textContent = this.scenario.title;
        document.getElementById('scoreIdeale').textContent = this.scores.ideale;
        document.getElementById('scoreAcceptable').textContent = this.scores.acceptable;
        document.getElementById('scoreMauvaise').textContent = this.scores.mauvaise;

        const total = this.scores.ideale + this.scores.acceptable;
        const ratio = total > 0 ? this.scores.ideale / total : 0;
        let level = '5-6';
        if (ratio >= 0.8 && this.scores.mauvaise === 0) level = '8-9';
        else if (ratio >= 0.6) level = '7-8';
        else if (ratio >= 0.4) level = '6-7';
        document.getElementById('nclcLevel').textContent = level;

        const tips = [];
        if (this.scores.mauvaise > 0) tips.push('√âvitez les formulations vagues ou trop informelles.');
        if (this.scores.acceptable > this.scores.ideale) tips.push('Anticipez les d√©tails importants dans vos questions.');
        if (this.scores.ideale >= 3) tips.push('Excellent travail sur la pr√©cision et le registre formel !');
        tips.push('Continuez √† pratiquer pour automatiser les formulations NCLC 8.');
        document.getElementById('tipsList').innerHTML = tips.map(t => `<li>${t}</li>`).join('');

        this.showScreen('screenResults');
    }
};

document.addEventListener('DOMContentLoaded', () => App.init());
</script>
</body>
</html>
