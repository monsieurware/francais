<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French Phonetics Master</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        h1 {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
            font-weight: 300;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.8em;
            color: #764ba2;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .phoneme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .phoneme-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .phoneme-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .phoneme-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .phoneme-card:hover::before {
            transform: scaleX(1);
        }

        .phoneme-card.playing {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .phoneme-card.playing .ipa {
            color: white;
        }

        .phoneme-card.playing .examples {
            color: rgba(255, 255, 255, 0.9);
        }

        .ipa {
            font-size: 2.5em;
            color: #667eea;
            font-weight: 700;
            margin-bottom: 10px;
            font-family: 'Arial Unicode MS', sans-serif;
        }

        .phoneme-label {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .examples {
            font-size: 1em;
            color: #555;
            line-height: 1.6;
        }

        .example-word {
            font-weight: 600;
            color: #764ba2;
        }

        .phoneme-card.playing .example-word {
            color: #fff;
        }

        .practice-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
        }

        .practice-word {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .practice-word-text {
            font-size: 2em;
            color: #667eea;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .practice-word-translation {
            color: #666;
            font-size: 1em;
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .info-box {
            background: rgba(102, 126, 234, 0.1);
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .info-box p {
            color: #555;
            line-height: 1.6;
        }

        .speaker-icon {
            font-size: 1.2em;
            margin-left: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .phoneme-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Matching Activity Styles */
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 20px;
        }

        .matching-column {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .matching-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .matching-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            text-align: center;
            font-weight: 600;
        }

        .matching-option:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .matching-option.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .matching-option.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .matching-option.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .matching-result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
        }

        .matching-result.show {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4caf50;
            color: #2e7d32;
        }

        /* Recording Section Styles */
        .recording-section {
            text-align: center;
        }

        .recording-word-display {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .recording-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .btn-lg {
            padding: 15px 35px;
            font-size: 1.1em;
        }

        .btn-record {
            background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
        }

        .btn-record.recording {
            background: linear-gradient(135deg, #ff5722 0%, #ff9800 100%);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .audio-visualizer {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .waveform {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 8px;
            height: 80px;
        }

        .bar {
            width: 12px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            transition: height 0.1s ease;
        }

        .waveform.active .bar {
            animation: wave 1s ease-in-out infinite;
        }

        .waveform.active .bar:nth-child(1) { animation-delay: 0s; }
        .waveform.active .bar:nth-child(2) { animation-delay: 0.1s; }
        .waveform.active .bar:nth-child(3) { animation-delay: 0.2s; }
        .waveform.active .bar:nth-child(4) { animation-delay: 0.3s; }
        .waveform.active .bar:nth-child(5) { animation-delay: 0.4s; }
        .waveform.active .bar:nth-child(6) { animation-delay: 0.3s; }
        .waveform.active .bar:nth-child(7) { animation-delay: 0.2s; }
        .waveform.active .bar:nth-child(8) { animation-delay: 0.1s; }

        @keyframes wave {
            0%, 100% {
                height: 20px;
            }
            50% {
                height: 70px;
            }
        }

        @media (max-width: 768px) {
            .matching-container {
                grid-template-columns: 1fr;
            }

            .recording-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .btn-lg {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🇫🇷 French Phonetics Master</h1>
            <p class="subtitle">Interactive pronunciation guide for intermediate learners</p>
        </header>

        <div class="info-box">
            <p><strong>💡 How to use:</strong> Click on any phoneme card to hear the pronunciation. The card will highlight as the sound plays. Practice the example words and listen carefully to master French pronunciation!</p>
            <p style="margin-top: 10px;"><strong>Note:</strong> The voice recording feature requires microphone access. If embedded in an LMS like Schoology, you may need to open this page in a new tab to use recording.</p>
        </div>

        <!-- Vowels Section -->
        <div class="section">
            <h2 class="section-title">Oral Vowels</h2>
            <div class="phoneme-grid" id="oral-vowels">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Nasal Vowels Section -->
        <div class="section">
            <h2 class="section-title">Nasal Vowels</h2>
            <div class="phoneme-grid" id="nasal-vowels">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Semi-Vowels Section -->
        <div class="section">
            <h2 class="section-title">Semi-Vowels</h2>
            <div class="phoneme-grid" id="semi-vowels">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Consonants Section -->
        <div class="section">
            <h2 class="section-title">Key Consonants</h2>
            <div class="phoneme-grid" id="consonants">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Practice Section -->
        <div class="practice-section">
            <h2 class="section-title">Practice Words</h2>
            <div id="practice-words">
                <!-- Will be populated by JavaScript -->
            </div>
            <div class="controls">
                <button class="btn" onclick="playRandomPracticeWord()">🎲 Random Word</button>
                <button class="btn" onclick="playAllPracticeWords()">▶️ Play All</button>
            </div>
        </div>

        <!-- Matching Activity Section -->
        <div class="practice-section" style="margin-top: 40px;">
            <h2 class="section-title">🎯 Matching Activity</h2>
            <p style="color: #666; margin-bottom: 20px;">Match the IPA symbols with the correct French words. Click to select!</p>
            
            <div class="matching-container">
                <div class="matching-column">
                    <h3 style="color: #667eea; margin-bottom: 15px;">IPA Symbols</h3>
                    <div id="ipa-options" class="matching-options">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                <div class="matching-column">
                    <h3 style="color: #764ba2; margin-bottom: 15px;">French Words</h3>
                    <div id="word-options" class="matching-options">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="checkMatches()">✓ Check Answers</button>
                <button class="btn" onclick="resetMatching()">🔄 New Game</button>
            </div>
            <div id="matching-result" class="matching-result"></div>
        </div>

        <!-- Voice Recording Section -->
        <div class="practice-section" style="margin-top: 40px;">
            <h2 class="section-title">🎤 Record Your Voice</h2>
            <p style="color: #666; margin-bottom: 20px;">Practice pronunciation by recording yourself and comparing with native audio!</p>
            
            <div id="iframe-warning" class="info-box" style="display: none; background: rgba(255, 152, 0, 0.1); border-left: 4px solid #ff9800; margin-bottom: 20px;">
                <p><strong>⚠️ Recording Not Available in Embedded View</strong></p>
                <p>Microphone access is blocked when this page is embedded in an iframe (like in Schoology). To use the recording feature, please open this page in a new tab:</p>
                <button class="btn" onclick="window.open(window.location.href, '_blank')" style="margin-top: 10px;">
                    🔗 Open in New Tab
                </button>
            </div>
            
            <div class="recording-section">
                <div class="recording-word-display">
                    <div id="recording-word" class="practice-word-text" style="font-size: 3em;">Bonjour</div>
                    <div id="recording-translation" class="practice-word-translation" style="font-size: 1.2em;">Hello</div>
                </div>

                <div class="recording-controls">
                    <button class="btn btn-lg" onclick="playTargetWord()">🔊 Listen to Native</button>
                    <button class="btn btn-lg btn-record" id="recordBtn" onclick="toggleRecording()">
                        <span id="recordIcon">⏺</span> <span id="recordText">Start Recording</span>
                    </button>
                    <button class="btn btn-lg" id="playbackBtn" onclick="playRecording()" disabled>▶️ Play Your Recording</button>
                </div>

                <div class="audio-visualizer" id="visualizer">
                    <div class="waveform">
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                    </div>
                </div>

                <div class="controls" style="margin-top: 20px;">
                    <button class="btn" onclick="changeRecordingWord()">🎲 Different Word</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Speech Synthesis
        const synth = window.speechSynthesis;
        let frenchVoice = null;

        // Load French voice
        function loadVoices() {
            const voices = synth.getVoices();
            frenchVoice = voices.find(voice => voice.lang.startsWith('fr')) || voices[0];
        }

        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = loadVoices;
        }
        loadVoices();

        // Phoneme data
        const oralVowels = [
            { ipa: 'i', label: 'vowel', examples: ['<span class="example-word">vie</span> (life), <span class="example-word">lit</span> (bed), <span class="example-word">gentil</span> (kind)'], word: 'vie' },
            { ipa: 'e', label: 'vowel', examples: ['<span class="example-word">été</span> (summer), <span class="example-word">clé</span> (key), <span class="example-word">café</span> (coffee)'], word: 'été' },
            { ipa: 'ɛ', label: 'vowel', examples: ['<span class="example-word">mère</span> (mother), <span class="example-word">fête</span> (party), <span class="example-word">treize</span> (thirteen)'], word: 'mère' },
            { ipa: 'a', label: 'vowel', examples: ['<span class="example-word">chat</span> (cat), <span class="example-word">table</span> (table), <span class="example-word">avoir</span> (to have)'], word: 'chat' },
            { ipa: 'u', label: 'vowel', examples: ['<span class="example-word">vous</span> (you), <span class="example-word">goût</span> (taste), <span class="example-word">groupe</span> (group)'], word: 'vous' },
            { ipa: 'y', label: 'vowel', examples: ['<span class="example-word">tu</span> (you), <span class="example-word">lune</span> (moon), <span class="example-word">pur</span> (pure)'], word: 'lune' },
            { ipa: 'ø', label: 'vowel', examples: ['<span class="example-word">peu</span> (little), <span class="example-word">deux</span> (two), <span class="example-word">feu</span> (fire)'], word: 'deux' },
            { ipa: 'œ', label: 'vowel', examples: ['<span class="example-word">cœur</span> (heart), <span class="example-word">sœur</span> (sister), <span class="example-word">peur</span> (fear)'], word: 'cœur' },
            { ipa: 'o', label: 'vowel', examples: ['<span class="example-word">beau</span> (beautiful), <span class="example-word">eau</span> (water), <span class="example-word">rose</span> (pink)'], word: 'beau' },
            { ipa: 'ɔ', label: 'vowel', examples: ['<span class="example-word">fort</span> (strong), <span class="example-word">porte</span> (door), <span class="example-word">pomme</span> (apple)'], word: 'porte' },
            { ipa: 'ə', label: 'vowel', examples: ['<span class="example-word">le</span> (the), <span class="example-word">petit</span> (small), <span class="example-word">regard</span> (look)'], word: 'le petit' },
            { ipa: 'œj', label: 'diphthong', examples: ['<span class="example-word">œil</span> (eye), <span class="example-word">fauteuil</span> (armchair), <span class="example-word">accueil</span> (welcome)'], word: 'œil' },
            { ipa: 'uj', label: 'diphthong', examples: ['<span class="example-word">grenouille</span> (frog), <span class="example-word">fouille</span> (search), <span class="example-word">citrouille</span> (pumpkin)'], word: 'grenouille' }
        ];

        const nasalVowels = [
            { ipa: 'ɑ̃', label: 'nasal', examples: ['<span class="example-word">blanc</span> (white), <span class="example-word">dans</span> (in), <span class="example-word">enfant</span> (child)'], word: 'blanc' },
            { ipa: 'ɛ̃', label: 'nasal', examples: ['<span class="example-word">vin</span> (wine), <span class="example-word">pain</span> (bread), <span class="example-word">important</span> (important)'], word: 'vin' },
            { ipa: 'ɔ̃', label: 'nasal', examples: ['<span class="example-word">bon</span> (good), <span class="example-word">nom</span> (name), <span class="example-word">maison</span> (house)'], word: 'bon' },
            { ipa: 'œ̃', label: 'nasal', examples: ['<span class="example-word">un</span> (one), <span class="example-word">parfum</span> (perfume), <span class="example-word">brun</span> (brown)'], word: 'parfum' },
            { ipa: 'jɛ̃', label: 'nasal + semi', examples: ['<span class="example-word">chien</span> (dog), <span class="example-word">bien</span> (well), <span class="example-word">combien</span> (how much)'], word: 'chien' }
        ];

        const semiVowels = [
            { ipa: 'j', label: 'semi-vowel', examples: ['<span class="example-word">hier</span> (yesterday), <span class="example-word">pied</span> (foot), <span class="example-word">fille</span> (girl)'], word: 'hier' },
            { ipa: 'w', label: 'semi-vowel', examples: ['<span class="example-word">oui</span> (yes), <span class="example-word">moi</span> (me), <span class="example-word">roi</span> (king)'], word: 'oui' },
            { ipa: 'ɥ', label: 'semi-vowel', examples: ['<span class="example-word">huit</span> (eight), <span class="example-word">nuit</span> (night), <span class="example-word">pluie</span> (rain)'], word: 'nuit' },
            { ipa: 'wa', label: 'combination', examples: ['<span class="example-word">trois</span> (three), <span class="example-word">bois</span> (wood), <span class="example-word">étoile</span> (star)'], word: 'trois' },
            { ipa: 'wɛ̃', label: 'combination', examples: ['<span class="example-word">loin</span> (far), <span class="example-word">coin</span> (corner), <span class="example-word">soin</span> (care)'], word: 'loin' }
        ];

        const consonants = [
            { ipa: 'ʁ', label: 'consonant', examples: ['<span class="example-word">rouge</span> (red), <span class="example-word">français</span> (French), <span class="example-word">horrible</span> (horrible)'], word: 'rouge' },
            { ipa: 'ʃ', label: 'consonant', examples: ['<span class="example-word">chat</span> (cat), <span class="example-word">chaud</span> (hot), <span class="example-word">machine</span> (machine)'], word: 'chaud' },
            { ipa: 'ʒ', label: 'consonant', examples: ['<span class="example-word">je</span> (I), <span class="example-word">garage</span> (garage), <span class="example-word">plage</span> (beach)'], word: 'je' },
            { ipa: 'ɲ', label: 'consonant', examples: ['<span class="example-word">montagne</span> (mountain), <span class="example-word">agneau</span> (lamb), <span class="example-word">champignon</span> (mushroom)'], word: 'montagne' },
            { ipa: 'Ø', label: 'silent H', examples: ['<span class="example-word">homme</span> (man), <span class="example-word">heure</span> (hour), <span class="example-word">hôtel</span> (hotel)'], word: 'homme' },
            { ipa: 'h', label: 'aspirated H', examples: ['<span class="example-word">hockey</span> (hockey), <span class="example-word">haricot</span> (bean), <span class="example-word">héros</span> (hero)'], word: 'hockey' },
            { ipa: 'ks', label: 'cluster', examples: ['<span class="example-word">taxi</span> (taxi), <span class="example-word">excellent</span> (excellent), <span class="example-word">boxe</span> (boxing)'], word: 'excellent' },
            { ipa: 'gz', label: 'cluster', examples: ['<span class="example-word">examen</span> (exam), <span class="example-word">exemple</span> (example), <span class="example-word">exact</span> (exact)'], word: 'examen' }
        ];

        const practiceWords = [
            { word: 'Bonjour', translation: 'Hello', ipa: '[bɔ̃ʒuʁ]' },
            { word: 'Merci', translation: 'Thank you', ipa: '[mɛʁsi]' },
            { word: 'Au revoir', translation: 'Goodbye', ipa: '[oʁvwaʁ]' },
            { word: 'S\'il vous plaît', translation: 'Please', ipa: '[silvuplɛ]' },
            { word: 'Aujourd\'hui', translation: 'Today', ipa: '[oʒuʁdɥi]' },
            { word: 'Maintenant', translation: 'Now', ipa: '[mɛ̃tnɑ̃]' },
            { word: 'Peut-être', translation: 'Maybe', ipa: '[pøtɛtʁ]' },
            { word: 'Beaucoup', translation: 'A lot', ipa: '[boku]' },
            { word: 'Grenouille', translation: 'Frog', ipa: '[gʁənuj]' },
            { word: 'Écureuil', translation: 'Squirrel', ipa: '[ekyʁœj]' },
            { word: 'Feuille', translation: 'Leaf', ipa: '[fœj]' },
            { word: 'Travail', translation: 'Work', ipa: '[tʁavaj]' },
            { word: 'Famille', translation: 'Family', ipa: '[famij]' },
            { word: 'Oiseau', translation: 'Bird', ipa: '[wazo]' },
            { word: 'Étoile', translation: 'Star', ipa: '[etwal]' },
            { word: 'Champignon', translation: 'Mushroom', ipa: '[ʃɑ̃piɲɔ̃]' },
            { word: 'Homme', translation: 'Man (silent H)', ipa: '[ɔm]' },
            { word: 'Heure', translation: 'Hour (silent H)', ipa: '[œʁ]' },
            { word: 'Hôtel', translation: 'Hotel (silent H)', ipa: '[otɛl]' },
            { word: 'Hockey', translation: 'Hockey (aspirated H)', ipa: '[ɔkɛ]' },
            { word: 'Haricot', translation: 'Bean (aspirated H)', ipa: '[aʁiko]' }
        ];

        // Function to speak text
        function speak(text, card) {
            if (synth.speaking) {
                synth.cancel();
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'fr-FR';
            utterance.rate = 0.8;
            
            if (frenchVoice) {
                utterance.voice = frenchVoice;
            }

            if (card) {
                card.classList.add('playing');
                utterance.onend = () => {
                    card.classList.remove('playing');
                };
            }

            synth.speak(utterance);
        }

        // Create phoneme card
        function createPhonemeCard(phoneme, container) {
            const card = document.createElement('div');
            card.className = 'phoneme-card';
            card.innerHTML = `
                <div class="ipa">${phoneme.ipa}</div>
                <div class="phoneme-label">${phoneme.label}</div>
                <div class="examples">${phoneme.examples}</div>
            `;
            card.onclick = () => speak(phoneme.word, card);
            container.appendChild(card);
        }

        // Populate sections
        const oralVowelsContainer = document.getElementById('oral-vowels');
        oralVowels.forEach(phoneme => createPhonemeCard(phoneme, oralVowelsContainer));

        const nasalVowelsContainer = document.getElementById('nasal-vowels');
        nasalVowels.forEach(phoneme => createPhonemeCard(phoneme, nasalVowelsContainer));

        const semiVowelsContainer = document.getElementById('semi-vowels');
        semiVowels.forEach(phoneme => createPhonemeCard(phoneme, semiVowelsContainer));

        const consonantsContainer = document.getElementById('consonants');
        consonants.forEach(phoneme => createPhonemeCard(phoneme, consonantsContainer));

        // Populate practice words
        const practiceWordsContainer = document.getElementById('practice-words');
        practiceWords.forEach(item => {
            const wordDiv = document.createElement('div');
            wordDiv.className = 'practice-word';
            wordDiv.innerHTML = `
                <div class="practice-word-text">${item.word}</div>
                <div class="practice-word-translation">${item.translation} ${item.ipa}</div>
            `;
            
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.innerHTML = 'Listen <span class="speaker-icon">🔊</span>';
            btn.onclick = () => speakPracticeWord(item.word, wordDiv);
            wordDiv.appendChild(btn);
            
            practiceWordsContainer.appendChild(wordDiv);
        });

        // Practice word functions
        function speakPracticeWord(word, element) {
            speak(word, element);
        }

        function playRandomPracticeWord() {
            const randomWord = practiceWords[Math.floor(Math.random() * practiceWords.length)];
            speak(randomWord.word);
        }

        function playAllPracticeWords() {
            let index = 0;
            
            function playNext() {
                if (index < practiceWords.length) {
                    const utterance = new SpeechSynthesisUtterance(practiceWords[index].word);
                    utterance.lang = 'fr-FR';
                    utterance.rate = 0.8;
                    
                    if (frenchVoice) {
                        utterance.voice = frenchVoice;
                    }

                    utterance.onend = () => {
                        index++;
                        setTimeout(playNext, 500);
                    };

                    synth.speak(utterance);
                }
            }

            playNext();
        }

        // ========== MATCHING ACTIVITY ==========
        let matchingPairs = [
            { ipa: 'ɑ̃', word: 'blanc', sound: 'blanc' },
            { ipa: 'ɛ̃', word: 'vin', sound: 'vin' },
            { ipa: 'ʁ', word: 'rouge', sound: 'rouge' },
            { ipa: 'ʃ', word: 'chaud', sound: 'chaud' },
            { ipa: 'y', word: 'lune', sound: 'lune' },
            { ipa: 'ø', word: 'deux', sound: 'deux' },
            { ipa: 'œj', word: 'œil', sound: 'œil' },
            { ipa: 'uj', word: 'grenouille', sound: 'grenouille' },
            { ipa: 'ɲ', word: 'montagne', sound: 'montagne' },
            { ipa: 'wa', word: 'trois', sound: 'trois' },
            { ipa: 'Ø', word: 'homme', sound: 'homme' },
            { ipa: 'h', word: 'hockey', sound: 'hockey' }
        ];

        let selectedIPA = null;
        let selectedWord = null;
        let matches = {};

        function initializeMatching() {
            const ipaContainer = document.getElementById('ipa-options');
            const wordContainer = document.getElementById('word-options');
            
            ipaContainer.innerHTML = '';
            wordContainer.innerHTML = '';
            
            // Shuffle words for variety
            const shuffledWords = [...matchingPairs].sort(() => Math.random() - 0.5);
            
            matchingPairs.forEach((pair, index) => {
                const ipaOption = document.createElement('div');
                ipaOption.className = 'matching-option';
                ipaOption.textContent = pair.ipa;
                ipaOption.dataset.id = index;
                ipaOption.onclick = () => selectIPA(index, ipaOption);
                ipaContainer.appendChild(ipaOption);
            });
            
            shuffledWords.forEach((pair, wordIndex) => {
                const wordOption = document.createElement('div');
                wordOption.className = 'matching-option';
                wordOption.textContent = pair.word;
                const originalIndex = matchingPairs.findIndex(p => p.word === pair.word);
                wordOption.dataset.id = originalIndex;
                wordOption.onclick = () => selectWord(originalIndex, wordOption, pair.sound);
                wordContainer.appendChild(wordOption);
            });

            matches = {};
            document.getElementById('matching-result').textContent = '';
            document.getElementById('matching-result').className = 'matching-result';
        }

        function selectIPA(id, element) {
            // Remove previous selection
            document.querySelectorAll('#ipa-options .matching-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            selectedIPA = id;
            element.classList.add('selected');
            
            // If word already selected, make match
            if (selectedWord !== null) {
                makeMatch();
            }
        }

        function selectWord(id, element, sound) {
            // Remove previous selection
            document.querySelectorAll('#word-options .matching-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            selectedWord = id;
            element.classList.add('selected');
            
            // Play the word
            speak(sound);
            
            // If IPA already selected, make match
            if (selectedIPA !== null) {
                makeMatch();
            }
        }

        function makeMatch() {
            matches[selectedIPA] = selectedWord;
            
            // Clear selections
            document.querySelectorAll('.matching-option.selected').forEach(opt => {
                opt.classList.remove('selected');
                opt.style.opacity = '0.5';
            });
            
            selectedIPA = null;
            selectedWord = null;
        }

        function checkMatches() {
            let correct = 0;
            const total = matchingPairs.length;
            
            // Reset all styles
            document.querySelectorAll('.matching-option').forEach(opt => {
                opt.classList.remove('correct', 'incorrect', 'selected');
                opt.style.opacity = '1';
            });
            
            Object.keys(matches).forEach(ipaId => {
                const wordId = matches[ipaId];
                const ipaElement = document.querySelector(`#ipa-options .matching-option[data-id="${ipaId}"]`);
                const wordElement = document.querySelector(`#word-options .matching-option[data-id="${wordId}"]`);
                
                if (parseInt(ipaId) === parseInt(wordId)) {
                    ipaElement.classList.add('correct');
                    wordElement.classList.add('correct');
                    correct++;
                } else {
                    ipaElement.classList.add('incorrect');
                    wordElement.classList.add('incorrect');
                }
            });
            
            const resultDiv = document.getElementById('matching-result');
            resultDiv.className = 'matching-result show';
            
            if (correct === total) {
                resultDiv.textContent = `🎉 Perfect! You got all ${total} matches correct!`;
            } else {
                resultDiv.textContent = `You got ${correct} out of ${total} correct. Try again!`;
            }
        }

        function resetMatching() {
            initializeMatching();
        }

        // Initialize matching game on load
        initializeMatching();

        // ========== VOICE RECORDING ==========
        let mediaRecorder;
        let audioChunks = [];
        let recordedBlob = null;
        let currentRecordingWord = 0;

        const recordingWords = [
            { word: 'Bonjour', translation: 'Hello' },
            { word: 'Merci beaucoup', translation: 'Thank you very much' },
            { word: 'Au revoir', translation: 'Goodbye' },
            { word: 'Comment allez-vous?', translation: 'How are you?' },
            { word: 'Grenouille', translation: 'Frog' },
            { word: 'Écureuil', translation: 'Squirrel' },
            { word: 'Feuille', translation: 'Leaf' },
            { word: 'Œil', translation: 'Eye' },
            { word: 'Champignon', translation: 'Mushroom' },
            { word: 'Oiseau', translation: 'Bird' },
            { word: 'Étoile', translation: 'Star' },
            { word: 'Famille', translation: 'Family' },
            { word: 'Travail', translation: 'Work' },
            { word: 'Homme', translation: 'Man (silent H)' },
            { word: 'Heure', translation: 'Hour (silent H)' },
            { word: 'Hôtel', translation: 'Hotel (silent H)' },
            { word: 'Hockey', translation: 'Hockey (aspirated H)' },
            { word: 'Haricot', translation: 'Bean (aspirated H)' },
            { word: 'Je ne comprends pas', translation: 'I don\'t understand' },
            { word: 'Parlez-vous français?', translation: 'Do you speak French?' }
        ];

        function updateRecordingDisplay() {
            const word = recordingWords[currentRecordingWord];
            document.getElementById('recording-word').textContent = word.word;
            document.getElementById('recording-translation').textContent = word.translation;
        }

        updateRecordingDisplay();

        // Check if page is in iframe and show warning
        function checkIframeStatus() {
            if (window.self !== window.top) {
                document.getElementById('iframe-warning').style.display = 'block';
            }
        }

        checkIframeStatus();

        function playTargetWord() {
            const word = recordingWords[currentRecordingWord].word;
            speak(word);
        }

        function changeRecordingWord() {
            currentRecordingWord = (currentRecordingWord + 1) % recordingWords.length;
            updateRecordingDisplay();
            recordedBlob = null;
            document.getElementById('playbackBtn').disabled = true;
        }

        async function toggleRecording() {
            const recordBtn = document.getElementById('recordBtn');
            const recordIcon = document.getElementById('recordIcon');
            const recordText = document.getElementById('recordText');
            const visualizer = document.querySelector('.waveform');

            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        recordedBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        document.getElementById('playbackBtn').disabled = false;
                        visualizer.classList.remove('active');
                        recordBtn.classList.remove('recording');
                    };

                    mediaRecorder.start();
                    recordBtn.classList.add('recording');
                    recordIcon.textContent = '⏹';
                    recordText.textContent = 'Stop Recording';
                    visualizer.classList.add('active');
                } catch (err) {
                    console.error('Error accessing microphone:', err);
                    
                    let errorMessage = 'Microphone access is required for recording.';
                    
                    if (window.self !== window.top) {
                        errorMessage = '⚠️ Recording is not available when this page is embedded in an iframe (like in Schoology).\n\nPlease click the "Open in New Tab" button above to use the recording feature.';
                    } else if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                        errorMessage = '⚠️ Microphone access was denied.\n\nPlease allow microphone access in your browser settings and try again.';
                    } else if (err.name === 'NotFoundError') {
                        errorMessage = '⚠️ No microphone found.\n\nPlease connect a microphone and try again.';
                    } else {
                        errorMessage = '⚠️ Could not access microphone.\n\n' + err.message;
                    }
                    
                    alert(errorMessage);
                }
            } else {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                recordIcon.textContent = '⏺';
                recordText.textContent = 'Start Recording';
            }
        }

        function playRecording() {
            if (recordedBlob) {
                const audioUrl = URL.createObjectURL(recordedBlob);
                const audio = new Audio(audioUrl);
                audio.play();
            }
        }
    </script>
</body>
</html>
